var Kinetic={version:"4.3.3",Filters:{},Plugins:{}};Kinetic.Global={stages:[],idCounter:0,ids:{},names:{},shapes:{},warn:function(t){window.console&&console.warn&&console.warn("Kinetic warning: "+t)},extend:function(t,e){for(var i in e.prototype)i in t.prototype||(t.prototype[i]=e.prototype[i])},_addId:function(t,e){void 0!==e&&(this.ids[e]=t)},_removeId:function(t){void 0!==t&&delete this.ids[t]},_addName:function(t,e){void 0!==e&&(void 0===this.names[e]&&(this.names[e]=[]),this.names[e].push(t))},_removeName:function(t,e){if(void 0!==t){var i=this.names[t];if(void 0!==i){for(var n=0;n<i.length;n++)i[n]._id===e&&i.splice(n,1);0===i.length&&delete this.names[t]}}}},function(t,e){"object"==typeof exports?module.exports=e():"function"==typeof define&&define.amd?define(e):t.returnExports=e()}(this,function(){return Kinetic}),Kinetic.Type={_isElement:function(t){return!!t&&1==t.nodeType},_isFunction:function(t){return!!(t&&t.constructor&&t.call&&t.apply)},_isObject:function(t){return!!t&&t.constructor==Object},_isArray:function(t){return"[object Array]"==Object.prototype.toString.call(t)},_isNumber:function(t){return"[object Number]"==Object.prototype.toString.call(t)},_isString:function(t){return"[object String]"==Object.prototype.toString.call(t)},_hasMethods:function(t){var e=[];for(var i in t)this._isFunction(t[i])&&e.push(i);return e.length>0},_isInDocument:function(t){for(;t=t.parentNode;)if(t==document)return!0;return!1},_getXY:function(t){if(this._isNumber(t))return{x:t,y:t};if(this._isArray(t)){if(1===t.length){var e=t[0];if(this._isNumber(e))return{x:e,y:e};if(this._isArray(e))return{x:e[0],y:e[1]};if(this._isObject(e))return e}else if(t.length>=2)return{x:t[0],y:t[1]}}else if(this._isObject(t))return t;return null},_getSize:function(t){if(this._isNumber(t))return{width:t,height:t};if(this._isArray(t))if(1===t.length){var e=t[0];if(this._isNumber(e))return{width:e,height:e};if(this._isArray(e)){if(e.length>=4)return{width:e[2],height:e[3]};if(e.length>=2)return{width:e[0],height:e[1]}}else if(this._isObject(e))return e}else{if(t.length>=4)return{width:t[2],height:t[3]};if(t.length>=2)return{width:t[0],height:t[1]}}else if(this._isObject(t))return t;return null},_getPoints:function(t){if(void 0===t)return[];if(this._isArray(t[0])){for(var e=[],i=0;i<t.length;i++)e.push({x:t[i][0],y:t[i][1]});return e}if(this._isObject(t[0]))return t;for(e=[],i=0;i<t.length;i+=2)e.push({x:t[i],y:t[i+1]});return e},_getImage:function(t,e){if(t)if(this._isElement(t))e(t);else if(this._isString(t))(n=new Image).onload=function(){e(n)},n.src=t;else if(t.data){var i=document.createElement("canvas");i.width=t.width,i.height=t.height,i.getContext("2d").putImageData(t,0,0);var n,a=i.toDataURL();(n=new Image).onload=function(){e(n)},n.src=a}else e(null);else e(null)},_rgbToHex:function(t,e,i){return((1<<24)+(t<<16)+(e<<8)+i).toString(16).slice(1)},_hexToRgb:function(t){var e=parseInt(t,16);return{r:e>>16&255,g:e>>8&255,b:255&e}},_getRandomColorKey:function(){var t=Math.round(255*Math.random()),e=Math.round(255*Math.random()),i=Math.round(255*Math.random());return this._rgbToHex(t,e,i)},_merge:function(t,e){var i=this._clone(e);for(var n in t)this._isObject(t[n])?i[n]=this._merge(t[n],i[n]):i[n]=t[n];return i},_clone:function(t){var e={};for(var i in t)this._isObject(t[i])?e[i]=this._clone(t[i]):e[i]=t[i];return e},_degToRad:function(t){return t*Math.PI/180},_radToDeg:function(t){return 180*t/Math.PI}},function(){var t=document.createElement("canvas").getContext("2d"),e=(window.devicePixelRatio||1)/(t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1);Kinetic.Canvas=function(t,i,n){this.pixelRatio=n||e,this.width=t,this.height=i,this.element=document.createElement("canvas"),this.context=this.element.getContext("2d"),this.setSize(t||0,i||0)},Kinetic.Canvas.prototype={clear:function(){var t=this.getContext(),e=this.getElement();t.clearRect(0,0,e.width,e.height)},getElement:function(){return this.element},getContext:function(){return this.context},setWidth:function(t){this.width=t,this.element.width=t*this.pixelRatio,this.element.style.width=t+"px"},setHeight:function(t){this.height=t,this.element.height=t*this.pixelRatio,this.element.style.height=t+"px"},getWidth:function(){return this.width},getHeight:function(){return this.height},setSize:function(t,e){this.setWidth(t),this.setHeight(e)},toDataURL:function(t,e){try{return this.element.toDataURL(t,e)}catch(t){try{return this.element.toDataURL()}catch(t){return Kinetic.Global.warn("Unable to get data URL. "+t.message),""}}},fill:function(t){t.getFillEnabled()&&this._fill(t)},stroke:function(t){t.getStrokeEnabled()&&this._stroke(t)},fillStroke:function(t){var e=t.getFillEnabled();e&&this._fill(t),t.getStrokeEnabled()&&this._stroke(t,t.hasShadow()&&t.hasFill()&&e)},applyShadow:function(t,e){var i=this.context;i.save(),this._applyShadow(t),e(),i.restore(),e()},_applyLineCap:function(t){var e=t.getLineCap();e&&(this.context.lineCap=e)},_applyOpacity:function(t){var e=t.getAbsoluteOpacity();1!==e&&(this.context.globalAlpha=e)},_applyLineJoin:function(t){var e=t.getLineJoin();e&&(this.context.lineJoin=e)},_applyAncestorTransforms:function(t){var e=this.context;t._eachAncestorReverse(function(t){var i=t.getTransform().getMatrix();e.transform(i[0],i[1],i[2],i[3],i[4],i[5])},!0)}},Kinetic.SceneCanvas=function(t,e,i){Kinetic.Canvas.call(this,t,e,i)},Kinetic.SceneCanvas.prototype={setWidth:function(t){var e=this.pixelRatio;Kinetic.Canvas.prototype.setWidth.call(this,t),this.context.scale(e,e)},setHeight:function(t){var e=this.pixelRatio;Kinetic.Canvas.prototype.setHeight.call(this,t),this.context.scale(e,e)},_fillColor:function(t){var e=this.context,i=t.getFill();e.fillStyle=i,t._fillFunc(e)},_fillPattern:function(t){var e=this.context,i=t.getFillPatternImage(),n=t.getFillPatternX(),a=t.getFillPatternY(),o=t.getFillPatternScale(),s=t.getFillPatternRotation(),r=t.getFillPatternOffset(),l=t.getFillPatternRepeat();(n||a)&&e.translate(n||0,a||0),s&&e.rotate(s),o&&e.scale(o.x,o.y),r&&e.translate(-1*r.x,-1*r.y),e.fillStyle=e.createPattern(i,l||"repeat"),e.fill()},_fillLinearGradient:function(t){for(var e=this.context,i=t.getFillLinearGradientStartPoint(),n=t.getFillLinearGradientEndPoint(),a=t.getFillLinearGradientColorStops(),o=e.createLinearGradient(i.x,i.y,n.x,n.y),s=0;s<a.length;s+=2)o.addColorStop(a[s],a[s+1]);e.fillStyle=o,e.fill()},_fillRadialGradient:function(t){for(var e=this.context,i=t.getFillRadialGradientStartPoint(),n=t.getFillRadialGradientEndPoint(),a=t.getFillRadialGradientStartRadius(),o=t.getFillRadialGradientEndRadius(),s=t.getFillRadialGradientColorStops(),r=e.createRadialGradient(i.x,i.y,a,n.x,n.y,o),l=0;l<s.length;l+=2)r.addColorStop(s[l],s[l+1]);e.fillStyle=r,e.fill()},_fill:function(t,e){var i=this.context,n=t.getFill(),a=t.getFillPatternImage(),o=t.getFillLinearGradientStartPoint(),s=t.getFillRadialGradientStartPoint(),r=t.getFillPriority();i.save(),!e&&t.hasShadow()&&this._applyShadow(t),n&&"color"===r?this._fillColor(t):a&&"pattern"===r?this._fillPattern(t):o&&"linear-gradient"===r?this._fillLinearGradient(t):s&&"radial-gradient"===r?this._fillRadialGradient(t):n?this._fillColor(t):a?this._fillPattern(t):o?this._fillLinearGradient(t):s&&this._fillRadialGradient(t),i.restore(),!e&&t.hasShadow()&&this._fill(t,!0)},_stroke:function(t,e){var i=this.context,n=t.getStroke(),a=t.getStrokeWidth(),o=t.getDashArray();(n||a)&&(i.save(),this._applyLineCap(t),o&&t.getDashArrayEnabled()&&(i.setLineDash?i.setLineDash(o):"mozDash"in i?i.mozDash=o:"webkitLineDash"in i&&(i.webkitLineDash=o)),!e&&t.hasShadow()&&this._applyShadow(t),i.lineWidth=a||2,i.strokeStyle=n||"black",t._strokeFunc(i),i.restore(),!e&&t.hasShadow()&&this._stroke(t,!0))},_applyShadow:function(t){var e=this.context;if(t.hasShadow()&&t.getShadowEnabled()){var i=t.getAbsoluteOpacity(),n=t.getShadowColor()||"black",a=t.getShadowBlur()||5,o=t.getShadowOffset()||{x:0,y:0};t.getShadowOpacity()&&(e.globalAlpha=t.getShadowOpacity()*i),e.shadowColor=n,e.shadowBlur=a,e.shadowOffsetX=o.x,e.shadowOffsetY=o.y}}},Kinetic.Global.extend(Kinetic.SceneCanvas,Kinetic.Canvas),Kinetic.HitCanvas=function(t,e,i){Kinetic.Canvas.call(this,t,e,i)},Kinetic.HitCanvas.prototype={_fill:function(t){var e=this.context;e.save(),e.fillStyle="#"+t.colorKey,t._fillFuncHit(e),e.restore()},_stroke:function(t){var e=this.context,i=t.getStroke(),n=t.getStrokeWidth();(i||n)&&(this._applyLineCap(t),e.save(),e.lineWidth=n||2,e.strokeStyle="#"+t.colorKey,t._strokeFuncHit(e),e.restore())}},Kinetic.Global.extend(Kinetic.HitCanvas,Kinetic.Canvas)}(),Kinetic.Transform=function(){this.m=[1,0,0,1,0,0]},Kinetic.Transform.prototype={translate:function(t,e){this.m[4]+=this.m[0]*t+this.m[2]*e,this.m[5]+=this.m[1]*t+this.m[3]*e},scale:function(t,e){this.m[0]*=t,this.m[1]*=t,this.m[2]*=e,this.m[3]*=e},rotate:function(t){var e=Math.cos(t),i=Math.sin(t),n=this.m[0]*e+this.m[2]*i,a=this.m[1]*e+this.m[3]*i,o=this.m[0]*-i+this.m[2]*e,s=this.m[1]*-i+this.m[3]*e;this.m[0]=n,this.m[1]=a,this.m[2]=o,this.m[3]=s},getTranslation:function(){return{x:this.m[4],y:this.m[5]}},multiply:function(t){var e=this.m[0]*t.m[0]+this.m[2]*t.m[1],i=this.m[1]*t.m[0]+this.m[3]*t.m[1],n=this.m[0]*t.m[2]+this.m[2]*t.m[3],a=this.m[1]*t.m[2]+this.m[3]*t.m[3],o=this.m[0]*t.m[4]+this.m[2]*t.m[5]+this.m[4],s=this.m[1]*t.m[4]+this.m[3]*t.m[5]+this.m[5];this.m[0]=e,this.m[1]=i,this.m[2]=n,this.m[3]=a,this.m[4]=o,this.m[5]=s},invert:function(){var t=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),e=this.m[3]*t,i=-this.m[1]*t,n=-this.m[2]*t,a=this.m[0]*t,o=t*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),s=t*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);this.m[0]=e,this.m[1]=i,this.m[2]=n,this.m[3]=a,this.m[4]=o,this.m[5]=s},getMatrix:function(){return this.m}},Kinetic.Collection=function(){var t=[].slice.call(arguments),e=t.length,i=0;for(this.length=e;i<e;i++)this[i]=t[i];return this},Kinetic.Collection.prototype=new Array,Kinetic.Collection.prototype.apply=function(t){args=[].slice.call(arguments),args.shift();for(var e=0;e<this.length;e++)Kinetic.Type._isFunction(this[e][t])&&this[e][t].apply(this[e],args)},Kinetic.Collection.prototype.each=function(t){for(var e=0;e<this.length;e++)t.call(this[e],e,this[e])},function(){Kinetic.Node=function(t){this._nodeInit(t)},Kinetic.Node.prototype={_nodeInit:function(t){this._id=Kinetic.Global.idCounter++,this.defaultNodeAttrs={visible:!0,listening:!0,name:void 0,opacity:1,x:0,y:0,scale:{x:1,y:1},rotation:0,offset:{x:0,y:0},draggable:!1,dragOnTop:!0},this.setDefaultAttrs(this.defaultNodeAttrs),this.eventListeners={},this.setAttrs(t)},on:function(t,e){for(var i=t.split(" "),n=i.length,a=0;a<n;a++){var o=i[a].split("."),s=o[0],r=o.length>1?o[1]:"";this.eventListeners[s]||(this.eventListeners[s]=[]),this.eventListeners[s].push({name:r,handler:e})}},off:function(t){for(var e=t.split(" "),i=e.length,n=0;n<i;n++){var a=(s=e[n]).split("."),o=a[0];if(a.length>1)if(o)this.eventListeners[o]&&this._off(o,a[1]);else for(var s in this.eventListeners)this._off(s,a[1]);else delete this.eventListeners[o]}},remove:function(){var t=this.getParent();t&&t.children&&(t.children.splice(this.index,1),t._setChildrenIndices()),delete this.parent},destroy:function(){this.getParent(),this.getStage();for(var t=Kinetic.DD,e=Kinetic.Global;this.children&&this.children.length>0;)this.children[0].destroy();e._removeId(this.getId()),e._removeName(this.getName(),this._id),t&&t.node&&t.node._id===this._id&&node._endDrag(),this.trans&&this.trans.stop(),this.remove()},getAttrs:function(){return this.attrs},setDefaultAttrs:function(t){if(void 0===this.attrs&&(this.attrs={}),t)for(var e in t)void 0===this.attrs[e]&&(this.attrs[e]=t[e])},setAttrs:function(t){if(t)for(var e in t){var i="set"+e.charAt(0).toUpperCase()+e.slice(1);Kinetic.Type._isFunction(this[i])?this[i](t[e]):this.setAttr(e,t[e])}},getVisible:function(){var t=this.attrs.visible,e=this.getParent();return!(t&&e&&!e.getVisible())&&t},getListening:function(){var t=this.attrs.listening,e=this.getParent();return!(t&&e&&!e.getListening())&&t},show:function(){this.setVisible(!0)},hide:function(){this.setVisible(!1)},getZIndex:function(){return this.index},getAbsoluteZIndex:function(){var t=this.getLevel(),e=(this.getStage(),this),i=0;return"Stage"!==e.nodeType&&function n(a){for(var o=[],s=a.length,r=0;r<s;r++){var l=a[r];i++,"Shape"!==l.nodeType&&(o=o.concat(l.getChildren())),l._id===e._id&&(r=s)}o.length>0&&o[0].getLevel()<=t&&n(o)}(e.getStage().getChildren()),i},getLevel:function(){for(var t=0,e=this.parent;e;)t++,e=e.parent;return t},setPosition:function(){var t=Kinetic.Type._getXY([].slice.call(arguments));this.setAttr("x",t.x),this.setAttr("y",t.y)},getPosition:function(){var t=this.attrs;return{x:t.x,y:t.y}},getAbsolutePosition:function(){var t=this.getAbsoluteTransform(),e=this.getOffset();return t.translate(e.x,e.y),t.getTranslation()},setAbsolutePosition:function(){var t=Kinetic.Type._getXY([].slice.call(arguments)),e=this._clearTransform();this.attrs.x=e.x,this.attrs.y=e.y,delete e.x,delete e.y;var i=this.getAbsoluteTransform();i.invert(),i.translate(t.x,t.y),t={x:this.attrs.x+i.getTranslation().x,y:this.attrs.y+i.getTranslation().y},this.setPosition(t.x,t.y),this._setTransform(e)},move:function(){var t=Kinetic.Type._getXY([].slice.call(arguments)),e=this.getX(),i=this.getY();void 0!==t.x&&(e+=t.x),void 0!==t.y&&(i+=t.y),this.setPosition(e,i)},_eachAncestorReverse:function(t,e){var i=[],n=this.getParent();for(e&&i.unshift(this);n;)i.unshift(n),n=n.parent;for(var a=i.length,o=0;o<a;o++)t(i[o])},rotate:function(t){this.setRotation(this.getRotation()+t)},rotateDeg:function(t){this.setRotation(this.getRotation()+Kinetic.Type._degToRad(t))},moveToTop:function(){var t=this.index;return this.parent.children.splice(t,1),this.parent.children.push(this),this.parent._setChildrenIndices(),!0},moveUp:function(){var t=this.index;if(t<this.parent.getChildren().length-1)return this.parent.children.splice(t,1),this.parent.children.splice(t+1,0,this),this.parent._setChildrenIndices(),!0},moveDown:function(){var t=this.index;if(t>0)return this.parent.children.splice(t,1),this.parent.children.splice(t-1,0,this),this.parent._setChildrenIndices(),!0},moveToBottom:function(){var t=this.index;if(t>0)return this.parent.children.splice(t,1),this.parent.children.unshift(this),this.parent._setChildrenIndices(),!0},setZIndex:function(t){var e=this.index;this.parent.children.splice(e,1),this.parent.children.splice(t,0,this),this.parent._setChildrenIndices()},getAbsoluteOpacity:function(){var t=this.getOpacity();return this.getParent()&&(t*=this.getParent().getAbsoluteOpacity()),t},moveTo:function(t){Kinetic.Node.prototype.remove.call(this),t.add(this)},toObject:function(){var t=Kinetic.Type,e={},i=this.attrs;for(var n in e.attrs={},i){var a=i[n];!t._isFunction(a)&&!t._isElement(a)&&(!t._isObject(a)||!t._hasMethods(a))&&(e.attrs[n]=a)}return e.nodeType=this.nodeType,e.shapeType=this.shapeType,e},toJSON:function(){return JSON.stringify(this.toObject())},getParent:function(){return this.parent},getLayer:function(){return this.getParent().getLayer()},getStage:function(){return this.getParent()?this.getParent().getStage():void 0},simulate:function(t,e){this._handleEvent(t,e||{})},fire:function(t,e){this._executeHandlers(t,e||{})},getAbsoluteTransform:function(){var t=new Kinetic.Transform;return this._eachAncestorReverse(function(e){var i=e.getTransform();t.multiply(i)},!0),t},getTransform:function(){var t=new Kinetic.Transform,e=this.attrs,i=e.x,n=e.y,a=e.rotation,o=e.scale,s=o.x,r=o.y,l=e.offset,h=l.x,c=l.y;return(0!==i||0!==n)&&t.translate(i,n),0!==a&&t.rotate(a),(1!==s||1!==r)&&t.scale(s,r),(0!==h||0!==c)&&t.translate(-1*h,-1*c),t},clone:function(t){var e=this.shapeType||this.nodeType,i=new Kinetic[e](this.attrs);for(var n in this.eventListeners)for(var a=this.eventListeners[n],o=a.length,s=0;s<o;s++){var r=a[s];r.name.indexOf("kinetic")<0&&(i.eventListeners[n]||(i.eventListeners[n]=[]),i.eventListeners[n].push(r))}return i.setAttrs(t),i},toDataURL:function(t){var e,i,n=(t=t||{}).mimeType||null,a=t.quality||null,o=t.x||0,s=t.y||0;return t.width&&t.height?e=new Kinetic.SceneCanvas(t.width,t.height,1):(e=this.getStage().bufferCanvas).clear(),(i=e.getContext()).save(),(o||s)&&i.translate(-1*o,-1*s),this.drawScene(e),i.restore(),e.toDataURL(n,a)},toImage:function(t){Kinetic.Type._getImage(this.toDataURL(t),function(e){t.callback(e)})},setSize:function(){var t=Kinetic.Type._getSize(Array.prototype.slice.call(arguments));this.setWidth(t.width),this.setHeight(t.height)},getSize:function(){return{width:this.getWidth(),height:this.getHeight()}},getWidth:function(){return this.attrs.width||0},getHeight:function(){return this.attrs.height||0},_get:function(t){return this.nodeType===t?[this]:[]},_off:function(t,e){for(var i=0;i<this.eventListeners[t].length;i++)if(this.eventListeners[t][i].name===e){if(this.eventListeners[t].splice(i,1),0===this.eventListeners[t].length){delete this.eventListeners[t];break}i--}},_clearTransform:function(){var t=this.attrs,e=t.scale,i=t.offset,n={x:t.x,y:t.y,rotation:t.rotation,scale:{x:e.x,y:e.y},offset:{x:i.x,y:i.y}};return this.attrs.x=0,this.attrs.y=0,this.attrs.rotation=0,this.attrs.scale={x:1,y:1},this.attrs.offset={x:0,y:0},n},_setTransform:function(t){for(var e in t)this.attrs[e]=t[e]},_fireBeforeChangeEvent:function(t,e,i){this._handleEvent("before"+t.toUpperCase()+"Change",{oldVal:e,newVal:i})},_fireChangeEvent:function(t,e,i){this._handleEvent(t+"Change",{oldVal:e,newVal:i})},setId:function(t){var e=this.getId(),i=(this.getStage(),Kinetic.Global);i._removeId(e),i._addId(this,t),this.setAttr("id",t)},setName:function(t){var e=this.getName(),i=(this.getStage(),Kinetic.Global);i._removeName(e,this._id),i._addName(this,t),this.setAttr("name",t)},setAttr:function(t,e){if(void 0!==e){var i=this.attrs[t];this._fireBeforeChangeEvent(t,i,e),this.attrs[t]=e,this._fireChangeEvent(t,i,e)}},_handleEvent:function(t,e,i){e&&"Shape"===this.nodeType&&(e.shape=this);this.getStage();var n=this.eventListeners,a=!0;"mouseenter"===t&&i&&this._id===i._id?a=!1:"mouseleave"===t&&i&&this._id===i._id&&(a=!1),a&&(n[t]&&this.fire(t,e),e&&!e.cancelBubble&&this.parent&&(i&&i.parent?this._handleEvent.call(this.parent,t,e,i.parent):this._handleEvent.call(this.parent,t,e)))},_executeHandlers:function(t,e){for(var i=this.eventListeners[t],n=i.length,a=0;a<n;a++)i[a].handler.apply(this,[e])}},Kinetic.Node.addSetters=function(t,e){for(var i=e.length,n=0;n<i;n++){var a=e[n];this._addSetter(t,a)}},Kinetic.Node.addPointSetters=function(t,e){for(var i=e.length,n=0;n<i;n++){var a=e[n];this._addPointSetter(t,a)}},Kinetic.Node.addRotationSetters=function(t,e){for(var i=e.length,n=0;n<i;n++){var a=e[n];this._addRotationSetter(t,a)}},Kinetic.Node.addGetters=function(t,e){for(var i=e.length,n=0;n<i;n++){var a=e[n];this._addGetter(t,a)}},Kinetic.Node.addRotationGetters=function(t,e){for(var i=e.length,n=0;n<i;n++){var a=e[n];this._addRotationGetter(t,a)}},Kinetic.Node.addGettersSetters=function(t,e){this.addSetters(t,e),this.addGetters(t,e)},Kinetic.Node.addPointGettersSetters=function(t,e){this.addPointSetters(t,e),this.addGetters(t,e)},Kinetic.Node.addRotationGettersSetters=function(t,e){this.addRotationSetters(t,e),this.addRotationGetters(t,e)},Kinetic.Node._addSetter=function(t,e){var i="set"+e.charAt(0).toUpperCase()+e.slice(1);t.prototype[i]=function(t){this.setAttr(e,t)}},Kinetic.Node._addPointSetter=function(t,e){var i="set"+e.charAt(0).toUpperCase()+e.slice(1);t.prototype[i]=function(){var t=Kinetic.Type._getXY([].slice.call(arguments));t&&void 0===t.x&&(t.x=this.attrs[e].x),t&&void 0===t.y&&(t.y=this.attrs[e].y),this.setAttr(e,t)}},Kinetic.Node._addRotationSetter=function(t,e){var i="set"+e.charAt(0).toUpperCase()+e.slice(1);t.prototype[i]=function(t){this.setAttr(e,t)},t.prototype[i+"Deg"]=function(t){this.setAttr(e,Kinetic.Type._degToRad(t))}},Kinetic.Node._addGetter=function(t,e){var i="get"+e.charAt(0).toUpperCase()+e.slice(1);t.prototype[i]=function(t){return this.attrs[e]}},Kinetic.Node._addRotationGetter=function(t,e){var i="get"+e.charAt(0).toUpperCase()+e.slice(1);t.prototype[i]=function(){return this.attrs[e]},t.prototype[i+"Deg"]=function(){return Kinetic.Type._radToDeg(this.attrs[e])}},Kinetic.Node.create=function(t,e){return this._createNode(JSON.parse(t),e)},Kinetic.Node._createNode=function(t,e){var i;i="Shape"===t.nodeType?void 0===t.shapeType?"Shape":t.shapeType:t.nodeType,e&&(t.attrs.container=e);var n=new Kinetic[i](t.attrs);if(t.children)for(var a=t.children.length,o=0;o<a;o++)n.add(this._createNode(t.children[o]));return n},Kinetic.Node.addGettersSetters(Kinetic.Node,["x","y","opacity"]),Kinetic.Node.addGetters(Kinetic.Node,["name","id"]),Kinetic.Node.addRotationGettersSetters(Kinetic.Node,["rotation"]),Kinetic.Node.addPointGettersSetters(Kinetic.Node,["scale","offset"]),Kinetic.Node.addSetters(Kinetic.Node,["width","height","listening","visible"]),Kinetic.Node.prototype.isListening=Kinetic.Node.prototype.getListening,Kinetic.Node.prototype.isVisible=Kinetic.Node.prototype.getVisible;for(var t=["on","off"],e=0;e<2;e++)!function(e){var i=t[e];Kinetic.Collection.prototype[i]=function(){var t=[].slice.call(arguments);t.unshift(i),this.apply.apply(this,t)}}(e)}(),Kinetic.Container=function(t){this._containerInit(t)},Kinetic.Container.prototype={_containerInit:function(t){this.children=[],Kinetic.Node.call(this,t)},getChildren:function(){return this.children},removeChildren:function(){for(;this.children.length>0;)this.children[0].remove()},add:function(t){Kinetic.Global;var e=this.children;return t.index=e.length,t.parent=this,e.push(t),this},get:function(t){var e=new Kinetic.Collection;if("#"===t.charAt(0)){var i=this._getNodeById(t.slice(1));i&&e.push(i)}else if("."===t.charAt(0)){var n=this._getNodesByName(t.slice(1));Kinetic.Collection.apply(e,n)}else{for(var a=[],o=this.getChildren(),s=o.length,r=0;r<s;r++)a=a.concat(o[r]._get(t));Kinetic.Collection.apply(e,a)}return e},_getNodeById:function(t){this.getStage();var e=Kinetic.Global.ids[t];return void 0!==e&&this.isAncestorOf(e)?e:null},_getNodesByName:function(t){var e=Kinetic.Global.names[t]||[];return this._getDescendants(e)},_get:function(t){for(var e=Kinetic.Node.prototype._get.call(this,t),i=this.getChildren(),n=i.length,a=0;a<n;a++)e=e.concat(i[a]._get(t));return e},toObject:function(){var t=Kinetic.Node.prototype.toObject.call(this);t.children=[];for(var e=this.getChildren(),i=e.length,n=0;n<i;n++){var a=e[n];t.children.push(a.toObject())}return t},_getDescendants:function(t){for(var e=[],i=t.length,n=0;n<i;n++){var a=t[n];this.isAncestorOf(a)&&e.push(a)}return e},isAncestorOf:function(t){for(var e=t.getParent();e;){if(e._id===this._id)return!0;e=e.getParent()}return!1},clone:function(t){var e=Kinetic.Node.prototype.clone.call(this,t);for(var i in this.children)e.add(this.children[i].clone());return e},getIntersections:function(){for(var t=Kinetic.Type._getXY(Array.prototype.slice.call(arguments)),e=[],i=this.get("Shape"),n=i.length,a=0;a<n;a++){var o=i[a];o.isVisible()&&o.intersects(t)&&e.push(o)}return e},_setChildrenIndices:function(){for(var t=this.children,e=t.length,i=0;i<e;i++)t[i].index=i},draw:function(){this.drawScene(),this.drawHit()},drawScene:function(t){if(this.isVisible())for(var e=this.children,i=e.length,n=0;n<i;n++)e[n].drawScene(t)},drawHit:function(){if(this.isVisible()&&this.isListening())for(var t=this.children,e=t.length,i=0;i<e;i++)t[i].drawHit()}},Kinetic.Global.extend(Kinetic.Container,Kinetic.Node),function(){function t(t){t.fill()}function e(t){t.stroke()}function i(t){t.fill()}function n(t){t.stroke()}Kinetic.Shape=function(t){this._initShape(t)},Kinetic.Shape.prototype={_initShape:function(a){this.setDefaultAttrs({fillEnabled:!0,strokeEnabled:!0,shadowEnabled:!0,dashArrayEnabled:!0,fillPriority:"color"}),this.nodeType="Shape",this._fillFunc=t,this._strokeFunc=e,this._fillFuncHit=i,this._strokeFuncHit=n;for(var o,s=Kinetic.Global.shapes;!(o=Kinetic.Type._getRandomColorKey())||o in s;);this.colorKey=o,s[o]=this,Kinetic.Node.call(this,a)},getContext:function(){return this.getLayer().getContext()},getCanvas:function(){return this.getLayer().getCanvas()},hasShadow:function(){return!!(this.getShadowColor()||this.getShadowBlur()||this.getShadowOffset())},hasFill:function(){return!!(this.getFill()||this.getFillPatternImage()||this.getFillLinearGradientStartPoint()||this.getFillRadialGradientStartPoint())},_get:function(t){return this.nodeType===t||this.shapeType===t?[this]:[]},intersects:function(){var t=Kinetic.Type._getXY(Array.prototype.slice.call(arguments)),e=this.getStage().hitCanvas;return e.clear(),this.drawScene(e),e.context.getImageData(Math.round(t.x),Math.round(t.y),1,1).data[3]>0},enableFill:function(){this.setAttr("fillEnabled",!0)},disableFill:function(){this.setAttr("fillEnabled",!1)},enableStroke:function(){this.setAttr("strokeEnabled",!0)},disableStroke:function(){this.setAttr("strokeEnabled",!1)},enableShadow:function(){this.setAttr("shadowEnabled",!0)},disableShadow:function(){this.setAttr("shadowEnabled",!1)},enableDashArray:function(){this.setAttr("dashArrayEnabled",!0)},disableDashArray:function(){this.setAttr("dashArrayEnabled",!1)},remove:function(){Kinetic.Node.prototype.remove.call(this),delete Kinetic.Global.shapes[this.colorKey]},drawScene:function(t){var e=this.attrs.drawFunc,i=(t=t||this.getLayer().getCanvas()).getContext();e&&this.isVisible()&&(i.save(),t._applyOpacity(this),t._applyLineJoin(this),t._applyAncestorTransforms(this),e.call(this,t),i.restore())},drawHit:function(){var t=this.attrs,e=t.drawHitFunc||t.drawFunc,i=this.getLayer().hitCanvas,n=i.getContext();e&&this.isVisible()&&this.isListening()&&(n.save(),i._applyLineJoin(this),i._applyAncestorTransforms(this),e.call(this,i),n.restore())},_setDrawFuncs:function(){!this.attrs.drawFunc&&this.drawFunc&&this.setDrawFunc(this.drawFunc),!this.attrs.drawHitFunc&&this.drawHitFunc&&this.setDrawHitFunc(this.drawHitFunc)}},Kinetic.Global.extend(Kinetic.Shape,Kinetic.Node),Kinetic.Node.addGettersSetters(Kinetic.Shape,["stroke","lineJoin","lineCap","strokeWidth","drawFunc","drawHitFunc","dashArray","shadowColor","shadowBlur","shadowOpacity","fillPatternImage","fill","fillPatternX","fillPatternY","fillLinearGradientColorStops","fillRadialGradientStartRadius","fillRadialGradientEndRadius","fillRadialGradientColorStops","fillPatternRepeat","fillEnabled","strokeEnabled","shadowEnabled","dashArrayEnabled","fillPriority"]),Kinetic.Node.addPointGettersSetters(Kinetic.Shape,["fillPatternOffset","fillPatternScale","fillLinearGradientStartPoint","fillLinearGradientEndPoint","fillRadialGradientStartPoint","fillRadialGradientEndPoint","shadowOffset"]),Kinetic.Node.addRotationGettersSetters(Kinetic.Shape,["fillPatternRotation"])}(),Kinetic.Stage=function(t){this._initStage(t)},Kinetic.Stage.prototype={_initStage:function(t){var e=Kinetic.DD;this.setDefaultAttrs({width:400,height:200}),Kinetic.Container.call(this,t),this._setStageDefaultProperties(),this._id=Kinetic.Global.idCounter++,this._buildDOM(),this._bindContentEvents(),Kinetic.Global.stages.push(this),e&&e._initDragLayer(this)},setContainer:function(t){"string"==typeof t&&(t=document.getElementById(t)),this.setAttr("container",t)},setHeight:function(t){Kinetic.Node.prototype.setHeight.call(this,t),this._resizeDOM()},setWidth:function(t){Kinetic.Node.prototype.setWidth.call(this,t),this._resizeDOM()},clear:function(){for(var t=this.children,e=0;e<t.length;e++)t[e].clear()},remove:function(){var t=this.content;Kinetic.Node.prototype.remove.call(this),t&&Kinetic.Type._isInDocument(t)&&this.attrs.container.removeChild(t)},reset:function(){this.removeChildren(),this._setStageDefaultProperties(),this.setAttrs(this.defaultNodeAttrs)},getMousePosition:function(){return this.mousePos},getTouchPosition:function(){return this.touchPos},getUserPosition:function(){return this.getTouchPosition()||this.getMousePosition()},getStage:function(){return this},getContent:function(){return this.content},toDataURL:function(t){var e=(t=t||{}).mimeType||null,i=t.quality||null,n=t.x||0,a=t.y||0,o=new Kinetic.SceneCanvas(t.width||this.getWidth(),t.height||this.getHeight()),s=o.getContext(),r=this.children;(n||a)&&s.translate(-1*n,-1*a),function n(a){var l=r[a].toDataURL(),h=new Image;h.onload=function(){s.drawImage(h,0,0),a<r.length-1?n(a+1):t.callback(o.toDataURL(e,i))},h.src=l}(0)},toImage:function(t){var e=t.callback;t.callback=function(t){Kinetic.Type._getImage(t,function(t){e(t)})},this.toDataURL(t)},getIntersection:function(t){for(var e=this.getChildren(),i=e.length-1;i>=0;i--){var n=e[i];if(n.isVisible()&&n.isListening()){var a=n.hitCanvas.context.getImageData(Math.round(t.x),Math.round(t.y),1,1).data;if(255===a[3]){var o=Kinetic.Type._rgbToHex(a[0],a[1],a[2]);return{shape:Kinetic.Global.shapes[o],pixel:a}}if(a[0]>0||a[1]>0||a[2]>0||a[3]>0)return{pixel:a}}}return null},_resizeDOM:function(){if(this.content){var t=this.attrs.width,e=this.attrs.height;this.content.style.width=t+"px",this.content.style.height=e+"px",this.bufferCanvas.setSize(t,e,1),this.hitCanvas.setSize(t,e);for(var i=this.children,n=0;n<i.length;n++){var a=i[n];a.getCanvas().setSize(t,e),a.hitCanvas.setSize(t,e),a.draw()}}},add:function(t){return Kinetic.Container.prototype.add.call(this,t),t.canvas.setSize(this.attrs.width,this.attrs.height),t.hitCanvas.setSize(this.attrs.width,this.attrs.height),t.draw(),this.content.appendChild(t.canvas.element),this},getDragLayer:function(){return this.dragLayer},_setUserPosition:function(t){t||(t=window.event),this._setMousePosition(t),this._setTouchPosition(t)},_bindContentEvents:function(){Kinetic.Global;for(var t=this,e=["mousedown","mousemove","mouseup","mouseout","touchstart","touchmove","touchend"],i=0;i<e.length;i++){var n=e[i];!function(){var e=n;t.content.addEventListener(e,function(i){t["_"+e](i)},!1)}()}},_mouseout:function(t){this._setUserPosition(t);var e=Kinetic.DD,i=this.targetShape;i&&(!e||!e.moving)&&(i._handleEvent("mouseout",t),i._handleEvent("mouseleave",t),this.targetShape=null),this.mousePos=void 0},_mousemove:function(t){this._setUserPosition(t);var e=Kinetic.DD,i=this.getIntersection(this.getUserPosition());if(i){var n=i.shape;n&&(e&&e.moving||255!==i.pixel[3]||this.targetShape&&this.targetShape._id===n._id?n._handleEvent("mousemove",t):(this.targetShape&&(this.targetShape._handleEvent("mouseout",t,n),this.targetShape._handleEvent("mouseleave",t,n)),n._handleEvent("mouseover",t,this.targetShape),n._handleEvent("mouseenter",t,this.targetShape),this.targetShape=n))}else this.targetShape&&(!e||!e.moving)&&(this.targetShape._handleEvent("mouseout",t),this.targetShape._handleEvent("mouseleave",t),this.targetShape=null);e&&e._drag(t)},_mousedown:function(t){var e,i=Kinetic.DD;if(this._setUserPosition(t),(e=this.getIntersection(this.getUserPosition()))&&e.shape){var n=e.shape;this.clickStart=!0,n._handleEvent("mousedown",t)}i&&this.attrs.draggable&&!i.node&&this._startDrag(t)},_mouseup:function(t){this._setUserPosition(t);var e=this,i=Kinetic.DD,n=this.getIntersection(this.getUserPosition());if(n&&n.shape){var a=n.shape;a._handleEvent("mouseup",t),this.clickStart&&(!i||!i.moving||!i.node)&&(a._handleEvent("click",t),this.inDoubleClickWindow&&a._handleEvent("dblclick",t),this.inDoubleClickWindow=!0,setTimeout(function(){e.inDoubleClickWindow=!1},this.dblClickWindow))}this.clickStart=!1},_touchstart:function(t){var e,i=Kinetic.DD;if(this._setUserPosition(t),t.preventDefault(),(e=this.getIntersection(this.getUserPosition()))&&e.shape){var n=e.shape;this.tapStart=!0,n._handleEvent("touchstart",t)}i&&this.attrs.draggable&&!i.node&&this._startDrag(t)},_touchend:function(t){this._setUserPosition(t);var e=this,i=Kinetic.DD,n=this.getIntersection(this.getUserPosition());if(n&&n.shape){var a=n.shape;a._handleEvent("touchend",t),this.tapStart&&(!i||!i.moving||!i.node)&&(a._handleEvent("tap",t),this.inDoubleClickWindow&&a._handleEvent("dbltap",t),this.inDoubleClickWindow=!0,setTimeout(function(){e.inDoubleClickWindow=!1},this.dblClickWindow))}this.tapStart=!1},_touchmove:function(t){this._setUserPosition(t);var e=Kinetic.DD;t.preventDefault();var i=this.getIntersection(this.getUserPosition());i&&i.shape&&i.shape._handleEvent("touchmove",t),e&&e._drag(t)},_setMousePosition:function(t){var e=t.clientX-this._getContentPosition().left,i=t.clientY-this._getContentPosition().top;this.mousePos={x:e,y:i}},_setTouchPosition:function(t){if(void 0!==t.touches&&1===t.touches.length){var e=t.touches[0],i=e.clientX-this._getContentPosition().left,n=e.clientY-this._getContentPosition().top;this.touchPos={x:i,y:n}}},_getContentPosition:function(){var t=this.content.getBoundingClientRect();return{top:t.top,left:t.left}},_buildDOM:function(){this.content=document.createElement("div"),this.content.style.position="relative",this.content.style.display="inline-block",this.content.className="kineticjs-content",this.attrs.container.appendChild(this.content),this.bufferCanvas=new Kinetic.SceneCanvas,this.hitCanvas=new Kinetic.HitCanvas,this._resizeDOM()},_onContent:function(t,e){for(var i=t.split(" "),n=0;n<i.length;n++){var a=i[n];this.content.addEventListener(a,e,!1)}},_setStageDefaultProperties:function(){this.nodeType="Stage",this.dblClickWindow=400,this.targetShape=null,this.mousePos=void 0,this.clickStart=!1,this.touchPos=void 0,this.tapStart=!1}},Kinetic.Global.extend(Kinetic.Stage,Kinetic.Container),Kinetic.Node.addGetters(Kinetic.Stage,["container"]),Kinetic.Layer=function(t){this._initLayer(t)},Kinetic.Layer.prototype={_initLayer:function(t){this.setDefaultAttrs({clearBeforeDraw:!0}),this.nodeType="Layer",this.beforeDrawFunc=void 0,this.afterDrawFunc=void 0,this.canvas=new Kinetic.SceneCanvas,this.canvas.getElement().style.position="absolute",this.hitCanvas=new Kinetic.HitCanvas,Kinetic.Container.call(this,t)},draw:function(){this.getContext(),void 0!==this.beforeDrawFunc&&this.beforeDrawFunc.call(this),Kinetic.Container.prototype.draw.call(this),void 0!==this.afterDrawFunc&&this.afterDrawFunc.call(this)},drawHit:function(){this.hitCanvas.clear(),Kinetic.Container.prototype.drawHit.call(this)},drawScene:function(t){t=t||this.getCanvas(),this.attrs.clearBeforeDraw&&t.clear(),Kinetic.Container.prototype.drawScene.call(this,t)},toDataURL:function(t){var e=(t=t||{}).mimeType||null,i=t.quality||null;return t.x,t.y,t.width||t.height||t.x||t.y?Kinetic.Node.prototype.toDataURL.call(this,t):this.getCanvas().toDataURL(e,i)},beforeDraw:function(t){this.beforeDrawFunc=t},afterDraw:function(t){this.afterDrawFunc=t},getCanvas:function(){return this.canvas},getContext:function(){return this.canvas.context},clear:function(){this.getCanvas().clear()},setVisible:function(t){Kinetic.Node.prototype.setVisible.call(this,t),t?(this.canvas.element.style.display="block",this.hitCanvas.element.style.display="block"):(this.canvas.element.style.display="none",this.hitCanvas.element.style.display="none")},setZIndex:function(t){Kinetic.Node.prototype.setZIndex.call(this,t);var e=this.getStage();e&&(e.content.removeChild(this.canvas.element),t<e.getChildren().length-1?e.content.insertBefore(this.canvas.element,e.getChildren()[t+1].canvas.element):e.content.appendChild(this.canvas.element))},moveToTop:function(){Kinetic.Node.prototype.moveToTop.call(this);var t=this.getStage();t&&(t.content.removeChild(this.canvas.element),t.content.appendChild(this.canvas.element))},moveUp:function(){if(Kinetic.Node.prototype.moveUp.call(this)){var t=this.getStage();t&&(t.content.removeChild(this.canvas.element),this.index<t.getChildren().length-1?t.content.insertBefore(this.canvas.element,t.getChildren()[this.index+1].canvas.element):t.content.appendChild(this.canvas.element))}},moveDown:function(){if(Kinetic.Node.prototype.moveDown.call(this)){var t=this.getStage();if(t){var e=t.getChildren();t.content.removeChild(this.canvas.element),t.content.insertBefore(this.canvas.element,e[this.index+1].canvas.element)}}},moveToBottom:function(){if(Kinetic.Node.prototype.moveToBottom.call(this)){var t=this.getStage();if(t){var e=t.getChildren();t.content.removeChild(this.canvas.element),t.content.insertBefore(this.canvas.element,e[1].canvas.element)}}},getLayer:function(){return this},remove:function(){var t=this.getStage(),e=this.canvas,i=e.element;Kinetic.Node.prototype.remove.call(this),t&&e&&Kinetic.Type._isInDocument(i)&&t.content.removeChild(i)}},Kinetic.Global.extend(Kinetic.Layer,Kinetic.Container),Kinetic.Node.addGettersSetters(Kinetic.Layer,["clearBeforeDraw"]),Kinetic.Group=function(t){this._initGroup(t)},Kinetic.Group.prototype={_initGroup:function(t){this.nodeType="Group",Kinetic.Container.call(this,t)}},Kinetic.Global.extend(Kinetic.Group,Kinetic.Container),Kinetic.Rect=function(t){this._initRect(t)},Kinetic.Rect.prototype={_initRect:function(t){this.setDefaultAttrs({width:0,height:0,cornerRadius:0}),Kinetic.Shape.call(this,t),this.shapeType="Rect",this._setDrawFuncs()},drawFunc:function(t){var e=t.getContext();e.beginPath();var i=this.getCornerRadius(),n=this.getWidth(),a=this.getHeight();0===i?e.rect(0,0,n,a):(e.moveTo(i,0),e.lineTo(n-i,0),e.arc(n-i,i,i,3*Math.PI/2,0,!1),e.lineTo(n,a-i),e.arc(n-i,a-i,i,0,Math.PI/2,!1),e.lineTo(i,a),e.arc(i,a-i,i,Math.PI/2,Math.PI,!1),e.lineTo(0,i),e.arc(i,i,i,Math.PI,3*Math.PI/2,!1)),e.closePath(),t.fillStroke(this)}},Kinetic.Global.extend(Kinetic.Rect,Kinetic.Shape),Kinetic.Node.addGettersSetters(Kinetic.Rect,["cornerRadius"]),function(){function t(t){t.fillText(this.partialText,0,0)}function e(t){t.strokeText(this.partialText,0,0)}var i="auto",a="",o="left",s="text",r=["fontFamily","fontSize","fontStyle","padding","align","lineHeight","text","width","height"],l=r.length;Kinetic.Text=function(t){this._initText(t)},Kinetic.Text.prototype={_initText:function(n){this.setDefaultAttrs({fontFamily:"Calibri",text:a,fontSize:12,align:o,verticalAlign:"top",fontStyle:"normal",padding:0,width:i,height:i,lineHeight:1}),this.dummyCanvas=document.createElement("canvas"),Kinetic.Shape.call(this,n),this._fillFunc=t,this._strokeFunc=e,this.shapeType="Text",this._setDrawFuncs();for(var s=0;s<l;s++)this.on(r[s]+"Change.kinetic",this._setTextData);this._setTextData()},drawFunc:function(t){var e=t.getContext(),i=this.getPadding(),n=this.getFontStyle(),a=this.getFontSize(),s=this.getFontFamily(),r=this.getTextHeight(),l=this.getLineHeight()*r,h=this.textArr,c=h.length,d=this.getWidth();e.font=n+" "+a+"px "+s,e.textBaseline="middle",e.textAlign=o,e.save(),e.translate(i,0),e.translate(0,i+r/2);for(var u=0;u<c;u++){var f=h[u],g=f.text,p=f.width;e.save(),"right"===this.getAlign()?e.translate(d-p-2*i,0):"center"===this.getAlign()&&e.translate((d-p-2*i)/2,0),this.partialText=g,t.fillStroke(this),e.restore(),e.translate(0,l)}e.restore()},drawHitFunc:function(t){var e=t.getContext(),i=this.getWidth(),n=this.getHeight();e.beginPath(),e.rect(0,0,i,n),e.closePath(),t.fillStroke(this)},setText:function(t){var e=Kinetic.Type._isString(t)?t:t.toString();this.setAttr(s,e)},getWidth:function(){return this.attrs.width===i?this.getTextWidth()+2*this.getPadding():this.attrs.width},getHeight:function(){return this.attrs.height===i?this.getTextHeight()*this.textArr.length*this.attrs.lineHeight+2*this.attrs.padding:this.attrs.height},getTextWidth:function(){return this.textWidth},getTextHeight:function(){return this.textHeight},_getTextSize:function(t){var e,i=this.dummyCanvas.getContext("2d"),n=this.getFontSize();return i.save(),i.font=this.getFontStyle()+" "+n+"px "+this.getFontFamily(),e=i.measureText(t),i.restore(),{width:e.width,height:parseInt(n,10)}},_expandTextData:function(t){var e=t.length;for(n=0,text=a,newArr=[],n=0;n<e;n++)text=t[n],newArr.push({text,width:this._getTextSize(text).width});return newArr},_setTextData:function(){var t=this.getText().split(a),e=[],n=0;for(addLine=!0,lineHeightPx=0,padding=this.getPadding(),this.textWidth=0,this.textHeight=this._getTextSize(this.getText()).height,lineHeightPx=this.getLineHeight()*this.textHeight;t.length>0&&addLine&&(this.attrs.height===i||lineHeightPx*(n+1)<this.attrs.height-2*padding);){var o=0,s=void 0;for(addLine=!1;o<t.length;){if(t.indexOf("\n")===o){t.splice(o,1),s=t.splice(0,o).join(a);break}var r=t.slice(0,o);if(this.attrs.width!==i&&this._getTextSize(r.join(a)).width>this.attrs.width-2*padding){if(0==o)break;var l=r.lastIndexOf(" "),h=r.lastIndexOf("\n"),c=Math.max(l,h);if(c>=0){s=t.splice(0,1+c).join(a);break}s=t.splice(0,o).join(a);break}++o===t.length&&(s=t.splice(0,o).join(a))}this.textWidth=Math.max(this.textWidth,this._getTextSize(s).width),void 0!==s&&(e.push(s),addLine=!0),n++}this.textArr=this._expandTextData(e)}},Kinetic.Global.extend(Kinetic.Text,Kinetic.Shape),Kinetic.Node.addGettersSetters(Kinetic.Text,["fontFamily","fontSize","fontStyle","padding","align","lineHeight"]),Kinetic.Node.addGetters(Kinetic.Text,[s])}(),Kinetic.Line=function(t){this._initLine(t)},Kinetic.Line.prototype={_initLine:function(t){this.setDefaultAttrs({points:[],lineCap:"butt"}),Kinetic.Shape.call(this,t),this.shapeType="Line",this._setDrawFuncs()},drawFunc:function(t){var e=this.getPoints(),i=e.length,n=t.getContext();n.beginPath(),n.moveTo(e[0].x,e[0].y);for(var a=1;a<i;a++){var o=e[a];n.lineTo(o.x,o.y)}t.stroke(this)},setPoints:function(t){this.setAttr("points",Kinetic.Type._getPoints(t))}},Kinetic.Global.extend(Kinetic.Line,Kinetic.Shape),Kinetic.Node.addGetters(Kinetic.Line,["points"]),function(t){"function"==typeof define&&define.amd&&define.amd.jQuery?define(["jquery"],t):t(jQuery)}(function(t){function e(t){return t}function i(t){return decodeURIComponent(t.replace(a," "))}function n(t){0===t.indexOf('"')&&(t=t.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"));try{return o.json?JSON.parse(t):t}catch(t){}}var a=/\+/g,o=t.cookie=function(a,s,r){if(void 0!==s){if("number"==typeof(r=t.extend({},o.defaults,r)).expires){var l=r.expires,h=r.expires=new Date;h.setDate(h.getDate()+l)}return s=o.json?JSON.stringify(s):String(s),document.cookie=[encodeURIComponent(a),"=",o.raw?s:encodeURIComponent(s),r.expires?"; expires="+r.expires.toUTCString():"",r.path?"; path="+r.path:"",r.domain?"; domain="+r.domain:"",r.secure?"; secure":""].join("")}for(var c=o.raw?e:i,d=document.cookie.split("; "),u=a?void 0:{},f=0,g=d.length;f<g;f++){var p=d[f].split("="),v=c(p.shift()),m=c(p.join("="));if(a&&a===v){u=n(m);break}a||(u[v]=n(m))}return u};o.defaults={},t.removeCookie=function(e,i){return void 0!==t.cookie(e)&&(t.cookie(e,"",t.extend(i,{expires:-1})),!0)}}),__whitespace={" ":!0,"\t":!0,"\n":!0,"\f":!0,"\r":!0},difflib={defaultJunkFunction:function(t){return __whitespace.hasOwnProperty(t)},stripLinebreaks:function(t){return t.replace(/^[\n\r]*|[\n\r]*$/g,"")},stringAsLines:function(t){for(var e=t.indexOf("\n"),i=t.indexOf("\r"),n=e>-1&&i>-1||i<0?"\n":"\r",a=t.split(n),o=0;o<a.length;o++)a[o]=difflib.stripLinebreaks(a[o]);return a},__reduce:function(t,e,i){if(null!=i)var n=i,a=0;else{if(!e)return null;n=e[0],a=1}for(;a<e.length;a++)n=t(n,e[a]);return n},__ntuplecomp:function(t,e){for(var i=Math.max(t.length,e.length),n=0;n<i;n++){if(t[n]<e[n])return-1;if(t[n]>e[n])return 1}return t.length==e.length?0:t.length<e.length?-1:1},__calculate_ratio:function(t,e){return e?2*t/e:1},__isindict:function(t){return function(e){return t.hasOwnProperty(e)}},__dictget:function(t,e,i){return t.hasOwnProperty(e)?t[e]:i},SequenceMatcher:function(t,e,i){this.set_seqs=function(t,e){this.set_seq1(t),this.set_seq2(e)},this.set_seq1=function(t){t!=this.a&&(this.a=t,this.matching_blocks=this.opcodes=null)},this.set_seq2=function(t){t!=this.b&&(this.b=t,this.matching_blocks=this.opcodes=this.fullbcount=null,this.__chain_b())},this.__chain_b=function(){for(var t=this.b,e=t.length,i=this.b2j={},n={},a=0;a<t.length;a++){var o=t[a];if(i.hasOwnProperty(o)){var s=i[o];e>=200&&100*s.length>e?(n[o]=1,delete i[o]):s.push(a)}else i[o]=[a]}for(var o in n)n.hasOwnProperty(o)&&delete i[o];var r=this.isjunk,l={};if(r){for(var o in n)n.hasOwnProperty(o)&&r(o)&&(l[o]=1,delete n[o]);for(var o in i)i.hasOwnProperty(o)&&r(o)&&(l[o]=1,delete i[o])}this.isbjunk=difflib.__isindict(l),this.isbpopular=difflib.__isindict(n)},this.find_longest_match=function(t,e,i,n){for(var a=this.a,o=this.b,s=this.b2j,r=this.isbjunk,l=t,h=i,c=0,d=null,u={},f=[],g=t;g<e;g++){var p={},v=difflib.__dictget(s,a[g],f);for(var m in v)if(v.hasOwnProperty(m)){if((d=v[m])<i)continue;if(d>=n)break;p[d]=k=difflib.__dictget(u,d-1,0)+1,k>c&&(l=g-k+1,h=d-k+1,c=k)}u=p}for(;l>t&&h>i&&!r(o[h-1])&&a[l-1]==o[h-1];)l--,h--,c++;for(;l+c<e&&h+c<n&&!r(o[h+c])&&a[l+c]==o[h+c];)c++;for(;l>t&&h>i&&r(o[h-1])&&a[l-1]==o[h-1];)l--,h--,c++;for(;l+c<e&&h+c<n&&r(o[h+c])&&a[l+c]==o[h+c];)c++;return[l,h,c]},this.get_matching_blocks=function(){if(null!=this.matching_blocks)return this.matching_blocks;for(var t,e,i,n,a,o,s,r,l,h=this.a.length,c=this.b.length,d=[[0,h,0,c]],u=[];d.length;)t=(a=d.pop())[0],e=a[1],i=a[2],n=a[3],o=(l=this.find_longest_match(t,e,i,n))[0],s=l[1],(r=l[2])&&(u.push(l),t<o&&i<s&&d.push([t,o,i,s]),o+r<e&&s+r<n&&d.push([o+r,e,s+r,n]));u.sort(difflib.__ntuplecomp);var f=j1=k1=block=0,g=[];for(var p in u)u.hasOwnProperty(p)&&(block=u[p],i2=block[0],j2=block[1],k2=block[2],f+k1==i2&&j1+k1==j2?k1+=k2:(k1&&g.push([f,j1,k1]),f=i2,j1=j2,k1=k2));return k1&&g.push([f,j1,k1]),g.push([h,c,0]),this.matching_blocks=g,this.matching_blocks},this.get_opcodes=function(){if(null!=this.opcodes)return this.opcodes;var t,e,i,n,a,o=0,s=0,r=[];this.opcodes=r;var l=this.get_matching_blocks();for(var h in l)l.hasOwnProperty(h)&&(e=(t=l[h])[0],i=t[1],n=t[2],a="",o<e&&s<i?a="replace":o<e?a="delete":s<i&&(a="insert"),a&&r.push([a,o,e,s,i]),o=e+n,s=i+n,n&&r.push(["equal",e,o,i,s]));return r},this.get_grouped_opcodes=function(t){t||(t=3);var e,i,n,a,o,s,r=this.get_opcodes();r||(r=[["equal",0,1,0,1]]),"equal"==r[0][0]&&(i=(e=r[0])[0],n=e[1],a=e[2],o=e[3],s=e[4],r[0]=[i,Math.max(n,a-t),a,Math.max(o,s-t),s]),"equal"==r[r.length-1][0]&&(i=(e=r[r.length-1])[0],n=e[1],a=e[2],o=e[3],s=e[4],r[r.length-1]=[i,n,Math.min(a,n+t),o,Math.min(s,o+t)]);var l=t+t,h=[];for(var c in r)r.hasOwnProperty(c)&&(i=(e=r[c])[0],n=e[1],a=e[2],o=e[3],s=e[4],"equal"==i&&a-n>l&&(h.push([i,n,Math.min(a,n+t),o,Math.min(s,o+t)]),n=Math.max(n,a-t),o=Math.max(o,s-t)),h.push([i,n,a,o,s]));return h&&"equal"==h[h.length-1][0]&&h.pop(),h},this.ratio=function(){return matches=difflib.__reduce(function(t,e){return t+e[e.length-1]},this.get_matching_blocks(),0),difflib.__calculate_ratio(matches,this.a.length+this.b.length)},this.quick_ratio=function(){var t,e;if(null==this.fullbcount){this.fullbcount=t={};for(var i=0;i<this.b.length;i++)t[e=this.b[i]]=difflib.__dictget(t,e,0)+1}t=this.fullbcount;var n={},a=difflib.__isindict(n),o=numb=0;for(i=0;i<this.a.length;i++)a(e=this.a[i])?numb=n[e]:numb=difflib.__dictget(t,e,0),n[e]=numb-1,numb>0&&o++;return difflib.__calculate_ratio(o,this.a.length+this.b.length)},this.real_quick_ratio=function(){var t=this.a.length,e=this.b.length;return _calculate_ratio(Math.min(t,e),t+e)},this.isjunk=i||difflib.defaultJunkFunction,this.a=this.b=null,this.set_seqs(t,e)}},mindmap=function(){var t=new Date(1,1,2e3,12,0,0),e=500;function n(t){for(var e=0,i=0;i<t.length;i++){var n=t.charAt(i);if("\t"==n&&e++,"\t"!=n&&" "!=n)break}return e}function a(t){var e={label:"",linkLabel:!1};if("("==(t=t.trim()).charAt(0)){var i=t.indexOf(")");0<i&&(e.linkLabel=t.substr(1,i-1),t=t.substring(i+1).trim())}return e.label=t,e}function o(t){return d.execute($("#textArea").val(),t),l=+new Date,function(){var t=1==d.settings("coloringMode")?d.getLevels()+1:d.getBranches()+1,e=1==d.settings("coloringMode")?"Level":"Branch";$("#colorsdiv").empty();for(var i=d.settings("bgcolors"),n=0;n<t;n++){i[n]||(i[n]=i[i.length-1],d.settings({bgcolors:i}));var a=0==n?"Root":e+" "+n;$("#colorsdiv").append("<input class='bgcolors' id='color"+n+"' pickerNbr="+n+" data-default-value="+i[n]+" type=text value='"+i[n]+"'>").append("<span class=s50>"+a+"</span><br>")}$(".bgcolors").minicolors({textfield:!1,change:function(t,e){var i=d.settings("bgcolors");i[parseInt(picker)]=t,d.settings({bgcolors:i})},show:function(){picker=$(this).attr("pickerNbr")},position:"top left",hideSpeed:0,showSpeed:0})}(),!1}function r(i){if(new Date-t<e)setTimeout(r,e);else{!1,i=i?$(window).innerWidth()-20:$(window).innerWidth()-$("#leftPane").width()-20;var n=$("#containerTable").height();d.settings({width:i,height:n})}}function h(){$("#logo i").hasClass("icon-chevron-down")?($("#logo i").removeClass("icon-chevron-down").addClass("icon-chevron-up"),$("#leftPane").hide()):($("#logo i").removeClass("icon-chevron-up").addClass("icon-chevron-down"),$("#leftPane").show()),r(!0)}function c(){if(setCookie(),$(".errorMsg").hide(),$(".loginUser").hide(),$("#sendMsg").html(""),logged_in&&userid?($("#mapEmail").val(user),$("#user").text(user),$(".guest").hide(),$(".user").show()):($(".user").hide(),$(".guest").show()),"unsaved"==savingState){var t=$("#textArea").val();(t=t.substring(0,t.indexOf("\n")))&&$("#mapTitle").val(t.replace("\t","")),$("#savingStateSaved").hide(),$("#savingStateViewOnly").hide(),$("#savingStateUnsaved").show()}else if("viewonly"==savingState)$("#savingStateSaved").hide(),$("#savingStateViewOnly").show(),$("#savingStateUnsaved").show();else{if("saved"!=savingState)return void console.log("Unknown saving state.");$("#savingStateViewOnly").hide(),$("#savingStateUnsaved").hide(),$("#savingStateSaved").show(),u()}}function u(){if("unsaved"==savingState||"viewonly"==savingState){var t=$("#mapTitle").val(),e=t&&0<t.length&&" "!=t&&"  "!=t;$("#reminderForT")[0].style.display=e?"none":"inline";var i=$("#mapEmail").val(),n=i&&2==i.split("@").length&&i.lastIndexOf(".")>i.indexOf("@");if($("#reminderForE")[0].style.display=n?"none":"inline",!e||!n)return!1}$(".savingInProgress").show(),$("#savingFinished").hide(),e=v(),t&&(e.maptitle=t),i&&(e.email=i),e.savingState=savingState,e.viewcode=viewcode,e.admincode=admincode,logged_in&&(e.userid=userid),$.ajax({url:"saveMap.php",type:"POST",data:e,success:function(t){$(".errorMsg").hide(),$("#savingFinished").show(),$(".savingInProgress").hide(),$("#saveMindMapBtn").hide(),t.status&&"OK"==t.status?(savingState="saved",admincode=t.admincode,viewcode=t.viewcode,$("#savingStateUnsaved").css("display","none"),$("#savingStateViewOnly").css("display","none"),$("#savingStateSaved").css("display","inline"),$(".savedMapInfo").show(),url="text2mindmap.com/"+t.admincode,$(".adminLink").html('<a href="http://'+url+'" target="_blank" title="Link to this mind map">'+url+"</a>"),url="text2mindmap.com/"+t.viewcode,$(".viewLink").html('<a href="http://'+url+'" target="_blank" title="Link to a view-only version of this mind map">'+url+"</a>"),$("#lastSavedInfo").html(t.lastsaved),hasChanged=!1,$(".saveMsg").hide()):(console.log("handleSaveResponse(): data.status did not return OK"),f())},timeout:3e4,error:function(t){f(t)}})}function f(t){$(".errorMsg").show(),console.log("handleSavingError(): There was an error while saving the file.",t.responseText)}function g(){return d.getImage(function(t){s=t,$("#thumbnailImage")[0].src=s},1),$("#downloadPNG").html('<i class="icon-download-alt"></i> Download image</button>'),$("#downloadPDF").html('<i class="icon-download-alt"></i> Download PDF</button>'),!1}function p(t,e){if(1==e){var i=s;$('<form method="POST" action="'+t+'" style="display:none"><textarea name="imgdata" style="display:none">'+i+"</textarea></form>").appendTo("body").submit(),$("#downloadPNG").html('<i class="icon-download-alt"></i> Download image')}else d.getImage(function(e){i=e,$('<form method="POST" action="'+t+'" style="display:none"><textarea name="imgdata" style="display:none">'+i+'</textarea><input type="hidden" name="logged_in" value="'+logged_in+'"></form>').appendTo("body").submit()},2),$("#downloadPDF").html('<i class="icon-download-alt"></i> Download PDF')}function v(){var t={};return t.text=$("#textArea").val(),t.font=d.settings("font"),t.fontColor=d.settings("fontColor"),t.fontSize=d.settings("fontSize"),t.lineColor=d.settings("lineColor"),t.lineWidth=d.settings("lineWidth"),t.coloringMode=d.settings("coloringMode"),t.bgcolors=JSON.stringify(d.settings("bgcolors")),t.positions=JSON.stringify(d.exportPositions()),t.showLockIcons=null,t.lockAfterMoving=d.settings("lockAfterMoving")?1:0,t.transform=JSON.stringify(d.settings("transform")),t.version=.4,t}$(document).ready(function(){d=new m("stageHolder",{width:$("#viewer-container").innerWidth(),height:$("#viewer-container").innerHeight()}),hasChanged=!1;var t="";$("#textArea").keydown(function(t){if(9==t.which||13==t.which){t.preventDefault();var e=this.selectionStart,i=this.selectionEnd,n=$(this).val(),a=n.lastIndexOf("\n",e-1)}if(9==t.which){if(e<=i){lastBreak=n.indexOf("\n",i-1),lastBreak<i&&(lastBreak=i);var s=n.substring(a+1,lastBreak).split("\n");if(nbr=0,t.shiftKey){s.forEach(function(t,e){"\t"==t.charAt(0)&&(s[e]=t.substring(1,t.length),nbr++)});var r=s.join("\n")}else r="\t"+s.join("\n\t"),nbr=s.length;$(this).val(n.substring(0,a+1)+r+n.substring(lastBreak,n.length)),this.selectionStart=t.shiftKey?e-Math.min(1,nbr):e+Math.min(1,nbr),this.selectionEnd=t.shiftKey?i-nbr:i+nbr}}else if(13==t.which){if(t.ctrlKey)return o();for(t="\n",i=a;i<=e;i++)if("\t"==(r=n.charAt(i)))t+="\t";else if(" "!=r&&"\n"!=r)break;"\n"==t&&-1==a&&(t="\n\t"),$(this).val(n.substring(0,e)+t+n.substring(e,n.length)),this.selectionStart=e+t.length,this.selectionEnd=e+t.length}}),$.support.style||$("#textArea").resizable({handles:"se",minWidth:288}),$("#indent").on("touchstart click",function(t){t.stopPropagation(),t.preventDefault(),$("#textArea").trigger(jQuery.Event("keydown",{which:9,shiftKey:!1}))}),$("#outdent").on("touchstart click",function(t){t.stopPropagation(),t.preventDefault(),$("#textArea").trigger(jQuery.Event("keydown",{which:9,shiftKey:!0}))}),$("#logo").on("touchstart click",function(t){t.stopPropagation(),t.preventDefault(),h()}),$("#showFaq").on("touchstart click",function(t){return t.stopPropagation(),t.preventDefault(),$("#faqMore").show(),$(this).hide(),!1}),$("#stageHolder").on("mousewheel",function(t){d.zoom(t.originalEvent.wheelDelta)}),$("#zoomInBtn").on("touchstart click",function(t){return t.stopPropagation(),t.preventDefault(),d.zoom(120),!1}),$("#zoomOutBtn").on("touchstart click",function(t){return t.stopPropagation(),t.preventDefault(),d.zoom(-120),!1}),$("#lockAfterMoving").change(function(){d.settings({lockAfterMoving:$(this).prop("checked")})}),$("#coloringMode").change(function(t){d.settings({coloringMode:$(this).val()})}),$("a.fonts").on("touchstart click",function(t){d.settings({font:$(this).text()})}),$("a.fontSize").on("mouseover touchstart",function(){d.settings({fontSize:$(this).text()})}),$(".lineWidth").on("mouseover touchstart",function(){d.settings({lineWidth:$(this).attr("val")})}),$("input.fontcolor").minicolors({textfield:!1,animationSpeed:0,change:function(t,e){d.settings({fontColor:t})},position:"top left",hideSpeed:0,showSpeed:0}),$("input.linecolor").minicolors({textfield:!1,animationSpeed:0,change:function(t,e){d.settings({lineColor:t})},position:"top left",hideSpeed:0,showSpeed:0}),$("body").keydown(function(t){if(t.ctrlKey||t.metaKey){switch(String.fromCharCode(t.which).toLowerCase()){case"s":t.preventDefault(),c();break;case"d":t.preventDefault(),g();break;case"t":t.preventDefault(),h()}187==t.which||107==t.which?d.zoom(120):189!=t.which&&109!=t.which||d.zoom(-120)}}),$("#mapEmail").keydown(function(t){13==t.which&&u()}),$("#signInFromModal").on("touchstart click",function(t){return t.stopPropagation(),t.preventDefault(),$(".user, .guest").hide(),$(".loginUser").show(),!1}),$("#signInBtn").on("touchstart click",function(t){setCookie()}),$("#signOutFromModal").on("touchstart click",function(t){return t.stopPropagation(),t.preventDefault(),$.get("index.php/user/signout/0",function(){userid=user=logged_in=!1,c()}),!1}),$("#signInFromModalForm").submit(function(t){$("#signInMsg").hide(),t.preventDefault(),t=$("#signInFromModalForm .user_username").val();var e=$("#signInFromModalForm .user_password").val();return t&&e?$.ajax({type:"POST",url:"index.php/user/signin",data:$("#signInFromModalForm").serialize(),success:function(t){"0"!=t&&0!=t&&t?(t=JSON.parse(t),userid=t.userid,user=t.user,logged_in=1,c()):$("#signInMsg").text("Sorry, wrong email/password combination").show()},error:function(){$("#signInMsg").text("Sorry, there seems to be a technical problem.").show()}}):$("#signInMsg").text("Please provide your email and password to sign in").show(),!1}),$("#saveAsGuestLink").on("touchstart click",function(t){t.stopPropagation(),t.preventDefault(),$(".loginUser, .user").hide(),$(".guest").show()}),$("#saveBtn, .saveBtn").on("touchstart click",function(t){return t.stopPropagation(),t.preventDefault(),c(),!1}),$("#saveMindMapBtn").on("touchstart click",function(t){return t.stopPropagation(),t.preventDefault(),u(),!1}),$("#mindmap-lock-all").on("touchstart click",function(t){return t.stopPropagation(),t.preventDefault(),d.setNodeLocks(!0),!1}),$("#mindmap-unlock-all").on("touchstart click",function(t){return t.stopPropagation(),t.preventDefault(),d.setNodeLocks(!1),!1}),$("#helpBtn").on("touchstart click",function(t){return t.stopPropagation(),t.preventDefault(),!1}),$("#newBtn, .newBtn").on("touchstart click",function(t){return t.stopPropagation(),t.preventDefault(),hasChanged&&0==confirm("Create a new mind map without saving this one first?")?t=void 0:($("#textArea").val(""),d.clear(),savingState="unsaved",viewcode=admincode="",hasChanged=!1,$(".saveMsg").hide(),$.cookie("current-mindmap",!1,{expires:-1}),t=!1),t}),$("#downloadBtn").on("touchstart click",function(t){return t.stopPropagation(),t.preventDefault(),g()}),$("#downloadPNG").on("touchstart click",function(t){t.stopPropagation(),t.preventDefault(),$("#downloadPNG").append(" <i class='icon-spinner icon-spinn'></i>"),p("downloadPNG.php",1)}),$("#downloadPDF").on("touchstart click",function(t){t.stopPropagation(),t.preventDefault(),$("#downloadPDF").append(" <i class='icon-spinner icon-spinn'></i>"),p("downloadPDF.php",2)}),$("#feedbackBtn").on("touchstart click",function(t){return t.stopPropagation(),t.preventDefault(),$("#sendFeedbackMsg").html("Sending... <i class='icon-spinner icon-spin'></i>"),$.ajax({url:"sendFeedback.php",data:{msg:$("#fm").val(),val:$("#fe").val(),admincode,viewcode},timeout:3e4,success:function(){$("#sendFeedbackMsg").html("<b class='text-success'>Sent. Thank you for your feedback.</b>")}}),!1}),$("#sendMailBtn").on("touchstart click",function(t){return $("#sendMsg").html("Sending... <i class='icon-spinner icon-spin'></i>"),t.stopPropagation(),t.preventDefault(),$.ajax({url:"sendMail.php",data:{address:$("#sendEmailMail").val(),admincode,viewcode},timeout:3e4,success:function(){$("#sendMsg").html(" <b class='text-success'> Sent</b>")},error:function(){$("#sendMsg").html(" Sorry, there seem to be a technical problem. Please try again later.")}}),!1}),$("#sendReminderBtn").on("touchstart click",function(t){return $("#sendReminderMsg").html("Sending... <i class='icon-spinner icon-spin'></i>"),t.stopPropagation(),t.preventDefault(),$.ajax({url:"sendReminder.php",data:{email:$("#forgot_e").val()},timeout:3e4,success:function(){$("#sendReminderMsg").html("<b class='text-success'>Email sent.</b>")},error:function(){$("#sendReminderMsg").html(" Error: Please try again later.")}}),!1}),$("#toggle1").on("touchstart click",function(t){$("#toggle1").removeClass("toggleInactive").addClass("toggleActive"),$("#toggle2").removeClass("toggleActive").addClass("toggleInactive"),$("#tab2").removeClass("active"),$("#tab1").addClass("active"),t.preventDefault()}),$("#toggle2").on("touchstart click",function(t){$("#toggle2").removeClass("toggleInactive").addClass("toggleActive"),$("#toggle1").removeClass("toggleActive").addClass("toggleInactive"),$("#tab1").removeClass("active"),$("#tab2").addClass("active"),t.preventDefault()}),$("#drawBtn").on("touchstart click",function(e){var i;e.stopPropagation(),e.preventDefault(),o(),$("#textArea").val()==t?($("#holder").popover({content:"<b class='text-success'>No changes have been made</b><br>Indent text using the <b>TAB key</b> on your keyboard, then draw again.",html:!0,trigger:"manual",delay:{show:200,hide:500}}).popover("show"),clearTimeout(i),i=setTimeout(function(){$("#holder").popover("destroy")},2200)):t=$("#textArea").val()}),x=$("#textArea").val().indexOf("\n",$("#textArea").val().indexOf("\n")+1),this.setSelectionRange&&$("#textArea")[0].setSelectionRange(x,x),setCookie=function(){if("error404"!=viewcode){var t=v();t&&($.cookie("current-mindmap",JSON.stringify(t),{expires:1}),$(".saveMsg").show()),(t=new Date).setTime(t.getTime()+6e5),$.cookie("timestamp","1",{expires:t})}}});var m=function(t,e){function o(e,i,n){n=void 0!==n&&n;var a=w.getTransform().m;return n?{x:(e-a[4])/a[0],y:(i-a[5])/a[3]}:{x:(e-(n=$("#"+t).offset()).left-a[4])/a[0],y:(i-n.top-a[5])/a[3]}}var s,r,l={bgcolors:"#3f3a3a #2365ba #16c75e #ff481c #ffa81c #365C8E #31975A #C2583F #C2903F #9d9d9d".split(" "),coloringMode:2,fontSize:20,fontMinSize:11,font:"Helvetica, Verdana, sans-serif",fontColor:"#ffffff",lineColor:"#cccccc",lineWidth:1.5,scale:1,lockAfterMoving:!0,linkLength:80,friction:.9,charge:1600,width:400,height:400,gravity:.1},h=(l=$.extend({},l,e),[]),c=0,d="",u=0,f=0,g=!1,p=!1,v={nodes:[],links:[]},m=0,y=0,w=new Kinetic.Layer,x=new Kinetic.Stage({container:t,width:l.width,height:l.height});x.add(w);var _=document.getElementById(t),S=$("#"+t);return S.on("touchstart mousedown",function(t){g||(p=!0,$(window).on("touchmove mousemove",function(t){t.stopPropagation(),t.preventDefault(),m&&y||(m=t.pageX||t.originalEvent.touches[0].pageX||t.originalEvent.changedTouches[0].pageX,y=t.pageY||t.originalEvent.touches[0].pageY||t.originalEvent.changedTouches[0].pageY);var e=t.pageX||t.originalEvent.touches[0].pageX||t.originalEvent.changedTouches[0].pageX;t=t.pageY||t.originalEvent.touches[0].pageY||t.originalEvent.changedTouches[0].pageY,w.move(e-m,t-y),m=e,y=t,w.draw()})),t.stopPropagation(),t.preventDefault()}),S.on("touchmove mousemove",function(t){g&&(t=o(t.pageX||t.originalEvent.targetTouches[0].pageX,t.pageY||t.originalEvent.targetTouches[0].pageY),g.x=t.x+s.x,g.y=t.y+s.y,g.px=g.x,g.py=g.y,.02>r.alpha()&&r.alpha(.025))}),$(window).on("mouseup touchend",function(t){p&&($(window).unbind("touchmove mousemove"),p=!1),g&&!1!==g.data.parent&&(g.fixed=l.lockAfterMoving),y=m=g=!1,t.stopPropagation(),t.preventDefault()}),that={settings:function(t,e,i){if(e=void 0===e||e,"object"==typeof t){if(l=$.extend({},l,t),void 0!==t.scale){if(r){var n=r.alpha();r.stop()}i=w.getScale().x;var a=t.scale;w.setScale(a),w.move(.5*l.width*(i-a),.5*l.height*(i-a)),r&&r.alpha(n)}if(void 0===t.height&&void 0===t.width||(r&&r.stop(),x.setHeight(l.height),x.setWidth(l.width),r&&r.alpha(.02)),void 0!==t.transform&&(n=t.transform,w.move(n[4],n[5]),w.setScale(n[0],n[3])),void 0!==t.linkLength||void 0!==t.charge||void 0!==t.friction||void 0!==t.gravity){if(!r)return;r.linkDistance(l.linkLength),r.charge(-l.charge),r.friction(l.friction),r.gravity(l.gravity)}}else if("string"==typeof t)return"transform"==t?w.getTransform().m:l[t];e&&that.redrawAll()},stopForce:function(){r&&r.stop()},execute:function(t,e){r&&r.stop(),that.text2mindmap(t),!0!==e&&(hasChanged=!0,$(".saveMsg").show()),r?r.start():r=d3.layout.force().linkDistance(l.linkLength).charge(-l.charge).friction(l.friction).theta(.99).gravity(l.gravity).size([l.width,l.height]).nodes(v.nodes).links(v.links).start().on("tick",function(){var t=r.alpha();.011>t&&r.alpha(.8*t),that.redraw()}).on("end",function(){setCookie()})},getImage:function(t,e){r.stop();var i=that.getBoundingBox(20),n=1==e?1:2736/i.width>1889/i.height?1889/i.height:2736/i.width,a=w.clone(),s=w.getScale().x,l=o(0,0,!0);a.move(l.x*s,l.y*s),a.move(-i.left,-i.top),a.setScale(1);var h=new Kinetic.Stage({container:"hiddenStage",width:i.width*n,height:i.height*n});h.add(a),h.setScale(n),a.draw(),that.fillLayerBackground(a,"#FFFFFF"),h.toDataURL({mimeType:"image/jpeg",quality:1,callback:function(e){t(e),a.remove(),h.remove()}})},computeLayoutOffline:function(t){r.start();for(var e=0;e<t;e++)r.tick();r.stop()},fillLayerBackground:function(t,e){var i=t.getCanvas(),n=t.getContext();n.save(),n.globalCompositeOperation="destination-over",n.setTransform(1,0,0,1,0,0),n.fillStyle="#FFFFFF",n.fillRect(0,0,i.width,i.height),n.restore()},clear:function(){w.removeChildren(),v.nodes=v={nodes:[],links:[]},r=!1,d="",that.execute("")},getBranches:function(){return u},getLevels:function(){return f},zoom:function(t){if(0<t&&1>w.getScale().x)t=Math.min(1,1.1*w.getScale().x),that.settings({scale:t});else{var e=23/Math.pow(.8,3);if(!(0>t&&l.fontSize<=l.fontMinSize||0<t&&l.fontSize>=e||0==r)){r.stop();var i=0<t?1:-1;v.nodes.forEach(function(t){t.x+=.2*(t.x-.5*x.getWidth())*i,t.y+=.2*(t.y-.5*x.getHeight())*i,t.px=t.x,t.py=t.y}),t=0>t?{fontSize:Math.max(l.fontMinSize,.8*l.fontSize),linkLength:Math.max(20,.7*l.linkLength),charge:Math.max(230,.6*l.charge),friction:Math.max(.87,l.friction-.01),gravity:Math.max(.025,l.gravity-.015)}:{fontSize:Math.min(23/Math.pow(.8,3),l.fontSize/.8),linkLength:Math.min(80/Math.pow(.7,3),l.linkLength/.7),charge:Math.min(1700/Math.pow(.6,3),l.charge/.6),friction:Math.min(.9,l.friction+.01),gravity:Math.min(.1,l.gravity+.015)},that.settings(t),r.start()}}},getBoundingBox:function(t){t||(t=0);for(var e=9999,i=9999,n=-9999,a=-9999,o=w.getChildren(),s=0;s<o.length;s++){var r=o[s];if("Group"==r.nodeType){var l=.5*r.children[0].attrs.width,h=.5*r.children[0].attrs.height;r.attrs.x-l<i&&(i=r.attrs.x-l),r.attrs.y-h<e&&(e=r.attrs.y-h),r.attrs.x+l>n&&(n=r.attrs.x+l),r.attrs.y+h>a&&(a=r.attrs.y+h)}}return{left:i-t,right:n+t,top:e-t,bottom:a+t,width:n-i+2*t,height:a-e+2*t}},addNode:function(t,e){r&&r.stop();var i={id:c++,fixed:e.fixed,x:e.x,y:e.y,data:e};return v.nodes.splice(t,0,i),i},addLink:function(t,e){v.links.push({source:t,target:e,data:{color:l.lineColor,weight:l.lineWidth,label:t.data.linkLabel}})},findNode:function(t){for(var e=0;e<v.nodes.length;e++)if(parseInt(v.nodes[e].id)==parseInt(t))return v.nodes[e];return!1},getLinksFrom:function(t){var e=[];return v.links.forEach(function(i){i.source.id==t.id&&e.push(i)}),e},getLinksTo:function(t){var e=[];return v.links.forEach(function(i){i.target.id==t.id&&e.push(i)}),e},isLinkedTo:function(t,e){for(var i=0;i<v.links.length;i++)if(v.links[i].source.id==t.id&&v.links[i].target.id==e.id)return!0;return!1},removeLink:function(t){v.links.forEach(function(e,i){e==t&&(e.ui&&e.ui.remove(),v.links.splice(i,1))})},setNodeLocks:function(t){v.nodes.forEach(function(e){e.data.parent&&(e.fixed=t)}),r&&0==t&&r.resume()},removeNode:function(t){r&&r.stop();var e=v.nodes[t];e?(that.getLinksFrom(e).forEach(function(t){that.removeLink(t)}),that.getLinksTo(e).forEach(function(t){that.removeLink(t)}),void 0!==e&&e.ui.remove(),v.nodes.splice(t,1)):console.log("Could node find node with pos:"+t+"\n\n"+JSON.stringify(v.nodes))},setStartPosition:function(t){if(0==t.data.parent)return t.x=.5*l.width,t.y=.5*l.height,t.px=t.x,t.py=t.y,t;t.x=t.data.parent.x,t.y=t.data.parent.y,(e=t.data.parent.data.children)||(e=4),h[t.data.parent.id]||(h[t.data.parent.id]=1);var e=135+360/e*(i=h[t.data.parent.id]++),i=Math.max(60,150-30*t.data.level);return t.x+=Math.round(i*Math.cos(e/360*2*Math.PI)+10*Math.random()),t.y+=Math.round(i*Math.sin(e/360*2*Math.PI)+10*Math.random()),t.px=t.x,t.py=t.y,t},redrawAll:function(){v.nodes.forEach(function(t){t.data=that.setTheme(t.data),t.data.redraw=!0}),v.links.forEach(function(t){t.data.color=l.lineColor,t.data.weight=l.lineWidth,t.data.redraw=!0}),that.redraw()},redraw:function(){v.links.forEach(function(t){t.ui&&!t.data.redraw?t.ui.setPoints([t.source,t.target]):(t.ui&&t.ui.remove(),t.ui=that.newLine(t,t.source,t.target),w.add(t.ui),t.ui.moveToBottom(),t.data.redraw=!1)}),v.nodes.forEach(function(t){t.ui&&!t.data.redraw?t.ui.setPosition(t.x,t.y):(t.ui&&t.ui.remove(),t.ui=that.newGroup(t),w.add(t.ui),t.data.redraw=!1)}),w.draw()},newLine:function(t,e,i){if(t.data.label){var n=i.x-e.x;i=i.y-e.y;var a=new Kinetic.Line({points:[{x:0,y:0},{x:n,y:i}],stroke:t.data.color,strokeWidth:t.data.weight}),o=new Kinetic.Text({text:t.data.label,fontSize:11,fontFamily:"Arial",fill:"#666",x:.5*n-50,y:.5*i-6,width:100,align:"center"}),s=new Kinetic.Group({x:e.x,y:e.y});return s.add(a),s.add(o),s.setPoints=function(t){var e=t[1].x-t[0].x,i=t[1].y-t[0].y;a.setPoints([{x:0,y:0},{x:e,y:i}]),o.setPosition(.5*e-50,.5*i-6),s.setPosition(t[0].x,t[0].y)},s}return new Kinetic.Line({points:[e,i],stroke:t.data.color,strokeWidth:t.data.weight})},newGroup:function(t){var e=new Kinetic.Group({x:t.x,y:t.y}),i=that.newText(t),n=i.getWidth(),a=i.getHeight();return i.setPosition(-.5*n,-.5*a),n=that.newRect(t,n,a),e.add(n),e.add(i),e.on("touchstart mousedown",function(e){e.stopPropagation(),e.preventDefault(),(g=t).fixed=!0;var i=o(e.pageX||e.originalEvent.targetTouches[0].pageX,e.pageY||e.originalEvent.targetTouches[0].pageY);s={x:g.x-i.x,y:g.y-i.y},e.preventDefault()}),e},newRect:function(t,e,i){return new Kinetic.Rect({x:-.5*e-1,y:-.5*i,width:e+2,height:i,cornerRadius:2,fill:t.data.color,opacity:1,shadowColor:"#999",shadowBlur:2,shadowOffset:2,shadowOpacity:.5})},newText:function(t){var e=new Kinetic.Text({x:0,y:0,text:t.data.label,fontSize:t.data.fontSize,fontFamily:t.data.font,fill:t.data.fontColor,padding:10-Math.min(3*t.data.level,5),align:"center"}),i=that.maxTextWidth(t);return e.getWidth()>i&&e.setAttrs({width:i}),e.on("mouseover",function(){_.style.cursor="pointer";for(var e=v.nodes.indexOf(t),i=$("#textArea").val().split(/\n/),n=-1,a=0;a<=e;a++)n+=i[a].length+1;-1!=n&&void 0!==n&&(i=n,(a=$("#textArea")[0]).setSelectionRange?(a.focus(),a.setSelectionRange(i,n)):a.createTextRange&&((a=a.createTextRange()).collapse(!0),a.moveEnd("character",n),a.moveStart("character",i),a.select()),n=$("#textArea"),i=parseInt(n.css("line-height")),n.scrollTop(e*i))}),e.on("mouseout",function(){g||(_.style.cursor="move")}),e},maxTextWidth:function(t){return new Kinetic.Text({text:"MMMMMMMMMMMMMMMMMMMM",fontSize:t.data.fontSize,fontFamily:t.data.font}).getWidth()},findParent:function(t,e,i){if(0==e)return!1;for(t=i[e];0<=e;e--)if(0<e&&(i[e]<t||0==e))return e;return 0},hashCode:function(t){var e=0;if(0==t.length)return e;for(i=0;i<t.length;i++)e=(e<<5)-e+t.charCodeAt(i);return e},exportPositions:function(){var t=[];return v.nodes.forEach(function(e,i){var n=parseFloat(e.x).toFixed(2),a=parseFloat(e.y).toFixed(2);t.push({i,x:n,y:a,f:e.fixed})}),t},importPositions:function(t,e){if(r&&r.stop(),.2>=parseFloat(e)){var i=[],n=[];v.nodes.forEach(function(e){i[e.data.level]?i[e.data.level]++:i[e.data.level]=1;var a=!!e.data.parent&&e.data.parent.data.oldId,o=n[a]+"-"+i[e.data.level];a=that.hashCode(e.data.label+"_"+(a?n[a]:void 0)+"_"+e.data.branch+"_"+e.data.level+"_"+a);e.data.oldId=a,n[a]=o;o=x.getWidth(),a=x.getHeight();for(var s=0;s<t.length;s++){var r=t[s];if(e.data.oldId==r.id){e.x=.5*o+r.x/22*o,e.y=.5*a+r.y/22*a,e.px=e.x,e.py=e.y,e.fixed=r.locked;break}}})}else for(var a=0;a<t.length;a++){var o=t[a],s=.4<=e?o.f:o.fixed,l=v.nodes[.4<=e?o.i:o.lineNbr];l&&(l.x=parseFloat(o.x),l.y=parseFloat(o.y),l.px=l.x,l.py=l.y,l.fixed=s)}r&&r.alpha(.025)},text2mindmap:function(t){var e=(e=t.split(/\n/).filter(function(t){return t.match(/\S/)})).join("\n");t=difflib.stringAsLines(e);for(var i=difflib.stringAsLines(d),o=new difflib.SequenceMatcher(i,t).get_opcodes(),s=0,r=0,l=0;l<o.length;l++)for(var h=(m=o[l])[0],c=m[1],g=m[2],p=m[3],m=m[4],y=Math.max(g-c,m-p),w=0;w<y;w++){if("delete"==h||"replace"==h&&p==m){var x=c-s+r;that.removeNode(x),s++}else if("insert"==h||"replace"==h&&c==g||"replace"==h&&!i[c]){var b=a(t[x=p]);that.addNode(x,{label:b.label,linkLabel:b.linkLabel,fixed:0==x,children:0}),r++}else"replace"==h&&(x=c,b=a(t[p]),v.nodes[x].data.label=b.label,v.nodes[x].data.linkLabel=b.linkLabel);c=c<g?c+1:c,p=p<m?p+1:p}var _=[],S=[];u=0,t.forEach(function(t,i){_[i]=n(t),S[i]=that.findParent(e,i,_),_[i]>f&&f++}),v.nodes.forEach(function(t,e){t.data.branch=1==_[e]?++u:u,t.data.level=_[e],t.data.parent=0!=e&&v.nodes[S[e]],t.data=that.setTheme(t.data),t.data.redraw=!0,t.data.parent&&!that.isLinkedTo(t,t.data.parent)&&(t.data.parent.data.children++,that.getLinksFrom(t).forEach(function(t){that.removeLink(t)}),that.addLink(t,t.data.parent));var i=that.getLinksFrom(t);(i=i[0])&&i.data.label!=t.data.linkLabel&&(i.data.label=t.data.linkLabel,i.data.redraw=!0)}),v.nodes.forEach(function(t,e){void 0===t.x&&that.setStartPosition(t)}),d=e},setTheme:function(t){var e;if(t.font=l.font,t.fontColor=l.fontColor?l.fontColor:"#fff",t.fontSize=Math.max(l.fontMinSize,Math.round(l.fontSize*(1-.17*t.level))),t.color=1==l.coloringMode?t.level>=l.bgcolors.length?l.bgcolors[l.bgcolors.length-1]:l.bgcolors[t.level]:t.branch>=l.bgcolors.length?l.bgcolors[l.bgcolors.length-1]:l.bgcolors[t.branch],void 0!==t.color&&null!=t.color||(t.color="#eeeeee"),n=t.color){3==(n=n.replace(/^\s*#|\s*$/g,"")).length&&(n=n.replace(/(.)/g,"$1$1")),e=parseInt(n.substr(0,2),16);var i=parseInt(n.substr(2,2),16),n=parseInt(n.substr(4,2),16);e="#"+(0|256+e+10*(256-e)/100).toString(16).substr(1)+(0|256+i+10*(256-i)/100).toString(16).substr(1)+(0|256+n+10*(256-n)/100).toString(16).substr(1)}else e=void 0;return t.shadow=e,t},text2tree:function(t){d=text=t.split(/\n/).filter(function(t){return t.match(/\S/)});var e,i=[],a=[];return b.each(text,function(t,o){a[t]=n(o);var s=that.findParent(text,t,a),r={name:o,children:[],lineNbr:t};0==t?(e=r,i[t]=r):(i[t]=r,i[s].children.push(r))}),console.log(JSON.stringify(e)),e}}};return Array.prototype.forEach||(Array.prototype.forEach=function(t,e){var i,n;if(null==this)throw new TypeError(" this is null or not defined");var a=Object(this),o=a.length>>>0;if("[object Function]"!={}.toString.call(t))throw new TypeError(t+" is not a function");for(e&&(i=e),n=0;n<o;){var s;n in a&&(s=a[n],t.call(i,s,n,a)),n++}}),{render:o,updateCanvasSize:function(){d.settings({width:$("#viewer-container").innerWidth(),height:$("#viewer-container").innerHeight()})}}}(),unsavedChanges=function(){const t="You have unsaved changes. Are you sure you want to continue?";let e=!1;function i(){return e}return{setHasChanges:function(t){e=t},getHasChanges:i,confirmContinue:function(e){return!i()||confirm(e||t)}}}(),settings=function(){const t="mindmap",e={documentContent:"MindMap\n\tTurn tab-indented lists into mind maps\n\t\tPress Tab to indent lines\n\t\tPress Shift + Tab to unindent lines\n\tDrag nodes to re-organize them\n\tThis project is based on the now dead site MindMap.com",documentTitle:"Untitled Document"};function i(e,i){i||(i=n(e));try{localStorage.setItem(t+e,JSON.stringify(i))}catch(t){console.error(`Error saving setting.\nKey: ${e}\nValue: ${i}\n`)}}function n(t){if(t in e)return e[t]}return{getSetting:function(e){let a;try{a=JSON.parse(localStorage.getItem(t+e))}catch(t){}return a&&""!=a||i(e,a=n(e)),a},setSetting:i,fontFamilyMap:{monospace:"monospace","sans-serif":"sans-serif",serif:"serif"},getDefaultValue:n,reset:function(){for(let t in e)i(t,n(t))}}}(),documentTitle=function(){const t=300,e=3;let i,n,a;function o(t){null!==t&&""!==t||(t=settings.getDefaultValue("documentTitle")),i.val(t),a=t,s(i,n),unsavedChanges.setHasChanges(!0),settings.setSetting("documentTitle",t)}function s(i,n){n.text(i.val());let a=parseInt(n.css("width"));isNaN(a)||(a+=e,a=Math.min(t,a),i.css("width",a+"px"))}return $(document).ready(function(){i=$(".document-title-input"),n=$(".document-title-mirror"),i.on("focusout",function(t){o(i.val())}),i.on("input change load focusout",function(){s(i,n)}),i.on("focus",function(t){i.val()===settings.getDefaultValue("documentTitle")&&i.select()}),i.on("keydown",function(t){13===t.keyCode?i.blur():27===t.keyCode&&(i.val(a),i.blur())})}),{getTitle:function(){return i.blur(),i.val()},setTitle:o,focus:function(){i.focus()}}}(),fileImport=function(){function t(t){t.stopPropagation(),t.preventDefault();if(t.target&&t.target.files&&t.target.files.length>0){const e=t.target.files[0],i=new FileReader,n=e.name;i.onloadend=function(t){!function(t,e){if(2!==t.target.readyState)return;if(t.target.error)return void alert("There was an error opening the file.");const i=t.target.result;documentTitle.setTitle(e.replace("/.txt$/","")),$("#textArea").val(i),mindmap.render(),unsavedChanges.setHasChanges(!1),settings.setSetting("documentTitle",settings.getDefaultValue("documentTitle")),settings.setSetting("documentContent",settings.getDefaultValue("documentContent"))}(t,n)},i.readAsText(e)}$("#file-input").val("")}return $(document).ready(function(){window.FileReader&&$("#file-input").on("change",t)}),{chooseFile:function(){window.FileReader?$("#file-input").click():alert("Your browser doesn't support opening files, consider upgrading to a newer version of your browser.")}}}(),fileExport=function(){return{saveFile:function(t,e,i){const n=new Blob([t]);if(window.navigator.msSaveOrOpenBlob)window.navigator.msSaveOrOpenBlob(n,e+i);else{const t=URL.createObjectURL(n),a=document.createElement("a");a.href=t,a.download=e+i,document.body.appendChild(a),a.click(),setTimeout(function(){document.body.removeChild(a),window.URL.revokeObjectURL(t)},0)}}}}(),appFunctions={fileNew(){unsavedChanges.confirmContinue()&&($("#textArea").val(settings.getDefaultValue("documentContent")),mindmap.render(),documentTitle.setTitle(settings.getDefaultValue("documentTitle")),unsavedChanges.setHasChanges(!1),settings.setSetting("documentContent",settings.getDefaultValue("documentContent")),settings.setSetting("documentTitle",settings.getDefaultValue("documentTitle")))},fileOpen(){unsavedChanges.confirmContinue()&&fileImport.chooseFile()},fileSave(){const t=$("#textArea").val(),e=documentTitle.getTitle();fileExport.saveFile(t,e,".txt"),unsavedChanges.setHasChanges(!1),settings.setSetting("documentTitle",settings.getDefaultValue("documentTitle")),settings.setSetting("documentContent",settings.getDefaultValue("documentContent"))},fileRename(){documentTitle.focus()},filePreferences(){$("#settings-modal").addClass("active")}},navbar=function(){function t(){$(".navbar-dropdown .dropdown-content").hide()}return $(document).ready(function(){const e={"file-new":appFunctions.fileNew,"file-open":appFunctions.fileOpen,"file-save":appFunctions.fileSave,"file-rename":appFunctions.fileRename,"file-preferences":appFunctions.filePreferences};$(".navbar a").on("click touchstart",function(i){"#"===$(this).attr("href")&&i.preventDefault();const n=$(this).attr("id");console.log(n),n in e&&(e[n]($(this)),t())}),$(document).on("click click",function(e){t();let i=$(e.target).parent(".navbar-dropdown");0!==i.length&&i.find(".dropdown-content").show()})}),{setVisibilityIcon:function(t,e){$(`#${t} > i`).removeClass("fa-eye fa-eye-slash"),e?$(`#${t} > i`).addClass("fa-eye"):$(`#${t} > i`).addClass("fa-eye-slash")}}}(),modal=function(){let t,e,i;$(document).ready(function(){t=$(".modal-tabs > li"),e=$(".tab-content"),(i=$(".close-modal")).on("click touchstart",function(){$(this).closest(".modal").removeClass("active")}),t.on("click touchstart",function(){e.removeClass("active"),$(`#${$(this).data("tab")}`).addClass("active"),t.removeClass("active"),$(this).addClass("active")})})}(),paneResizer=function(){let t,e,i,n,a,o,s,r,l;const h=200,c=100;let d,u,f=!1,g=!1,p=35,v=65;function m(s,r){if(Math.abs(s+r-100)>.1)return console.warn("Error resizing panes, percentages don't add up. Resetting to 50% split."),m(p=50,v=50);let f=t.width()/100*s,y=t.width()/100*r;if(e.show(),0===s||0===r){if(g&&t.width()>=2*h)return g=!1,m(p=d,v=u);0===s&&e.hide()}else{if(t.width()<2*h)return g=!0,m(p=100,v=0);if(f<c)return m(p=0,v=100);if(y<c)return m(p=100,v=0);f<h&&(f=h,y=t.width()-f),y<h&&(y=h,f=t.width()-y)}i.width(f),n.width(y),function(){0===i.width()?o.show():o.hide();0===n.width()?a.show():a.hide();l.hasScrollBar();a.css("left","calc(100% - 29px)"),0===p?o.css("margin-left","5px"):o.css("margin-left","10px")}(),mindmap.updateCanvasSize()}function y(){0===p?t.width()>=2*h?(p=d,v=u):(p=100,v=0):(p=0,v=100),m(p,v)}function w(){0===v?t.width()>=2*h?(p=d,v=u):(p=0,v=100):(p=100,v=0),m(p,v)}return $.fn.hasScrollBar=function(){return this.get(0).scrollHeight>this.innerHeight()},$(document).ready(function(){t=$("#pane-container"),e=$("#dragbar"),i=$("#editor-pane"),n=$("#viewer-pane"),a=$("#editor-collapse-button"),o=$("#viewer-collapse-button"),s=n.find("#viewer"),r=$("body"),l=$("#textArea"),a.css("visibility","visible"),o.css("visibility","visible"),d=p,u=v,m(p,v),$(window).on("resize",function(){m(p,v)}),a.on("click touchstart",w),o.on("click touchstart",y),e.on("mousedown",function(e){f=!0,r.addClass("no-selection");const a=e.pageX,o=i.width(),s=n.width();$(document).on("mousemove",function(e){if(f){const i=e.pageX-a,n=t.width()/100,r=(o+i)/n,l=(s-i)/n;v=l,(p=r)<h/n&&(v=100-(p=h/n)),v<h/n&&(p=100-(v=h/n)),d=p,u=v,m(r,l)}}),$(document).on("mouseup",function(){f&&(f=!1,r.removeClass("no-selection"),$(document).unbind("mousemove"))})})}),{toggleViewer:w,toggleEditor:y}}(),shortcuts=function(){const t={};function e(t,e){if(!t||!e)return!1;if(t.length!==e.length)return!1;t.sort(),e.sort();for(let i=0;i<t.length;i++)if(t[i]instanceof Array&&e[i]instanceof Array){if(!t[i].equals(e[i]))return!1}else if(t[i]!==e[i])return!1;return!0}return{addBinding:function(e,i){t[e.toLowerCase()]=i},addBindings:function(e){for(let i in e)t[i.toLowerCase()]=e[i]},handleKeypress:function(i){const n=[i.key.toLowerCase()];i.shiftKey&&n.push("shift"),(i.ctrlKey||i.metaKey)&&n.push("ctrl"),i.altKey&&n.push("alt");for(let a in t)e(a.split("+"),n)&&(i.preventDefault(),t[a]())}}}(),/Mobi/.test(navigator.userAgent)&&alert("The website doesn't currently work very well in mobile browsers, so it's recommended that you use a computer. Sorry about that!"),$(document).ready(function(){documentTitle.setTitle(settings.getSetting("documentTitle")),$(window).on("beforeunload",function(t){unsavedChanges.getHasChanges()}),$(document).on("keydown",shortcuts.handleKeypress);const t={"Ctrl+N":appFunctions.fileNew,"Ctrl+O":appFunctions.fileOpen,"Ctrl+S":appFunctions.fileSave};function e(){const t=$("#textArea").val();unsavedChanges.setHasChanges(t!==settings.getDefaultValue("documentContent")),settings.setSetting("documentContent",t),mindmap.render()}shortcuts.addBindings(t),$("#modal-settings-save").on("click",function(){$(".modal").removeClass("active")}),$("#textArea").val(settings.getSetting("documentContent")),mindmap.render(),$("#textArea").on("input propertychange",e),$("#textArea").on("keydown",function(t){let i=t.keyCode||t.which;9!=i&&13!=i||e(),unsavedChanges.setHasChanges(!0)})});